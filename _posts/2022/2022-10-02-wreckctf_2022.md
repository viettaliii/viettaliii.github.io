---
title: Writeup WRECKCTF 2022 #TiÃªu Ä‘á» hiá»‡n thá»‹ trÃªn trang
author: vietzettt
date:  2022-10-02 #NgÃ y táº¡o
layout: post
cover: /src/2022/Wreckctf/img_pages/00_cover.webp/ #thÃªm áº£nh bÃ¬a cho trang 
---

---

##### **Nguá»“n á»Ÿ Ä‘Ã¢y nhÃ¡ cÃ¡c báº¡n:** [ğŸ’€**Nháº¥p em Ä‘i**ğŸ‘†](https://github.com/vietzettt/vietzettt.github.io/tree/main/src/2022/Wreckctf/)
<!-- chá»— nÃ y ta sáº½ chÃ¨n link dáº«n Ä‘áº¿n nguá»“n tá»•ng nhÃ©-->

ChÃ o má»i ngÆ°á»i láº¡i quay trá»Ÿ láº¡i vá»›i má»™t giáº£i Ä‘áº¥u Ä‘Æ°á»£c gá»i lÃ  vá»«a sá»©c Ä‘á»‘i vá»›i nhá»¯ng ngÆ°á»i má»›i vÃ  trung bÃ¬nh kinh nghiá»‡m cÃ²n tháº¥p cá»§a tÃ´i. Sau Ä‘Ã¢y khÃ´ng lÃ²ng vÃ²ng tÃ´i Ä‘i vÃ o má»¥c tiÃªu chÃ­nh vá»›i 4/6 thá»­ thÃ¡ch RE - Dá»‹ch ngÆ°á»£c tÃ´i hoÃ n thÃ nh.

Sau chuá»—i bÃ i Ä‘áº§u tiÃªn tÃ´i sáº½ tinh gá»n nhá»¯ng bÆ°á»›c Ä‘Æ¡n giáº£n vÃ  cÃ¡c bÆ°á»›c Ä‘áº§u tiÃªn vÃ  sáº½ táº­p trung phÃ¢n tÃ­ch vÃ  tiáº¿p náº¡p cÃ¡c kiáº¿n thá»©c trong quÃ¡ trÃ¬nh giáº£i vÃ  tÃ¬m hiá»ƒu kiáº¿n thá»©c má»›i tá»« cÃ¡c challenges nhÃ¡.

### 1: flag-checker (Solved)

![title](/src/2022/Wreckctf/flag-checker/img/00_title.png)

TÃ´i sáº½ má»Ÿ nÃ³ báº±ng `IDA pro` vÃ  nháº­n Ä‘Æ°á»£c káº¿t quáº£ cá»§a hÃ m main:

```c
int __cdecl main(int argc, const char **argv, const char **envp)
{
  char s[3]; // [rsp+0h] [rbp-40h] BYREF
  char v5[3]; // [rsp+3h] [rbp-3Dh] BYREF
  char v6[3]; // [rsp+6h] [rbp-3Ah] BYREF
  char v7[3]; // [rsp+9h] [rbp-37h] BYREF
  char v8[3]; // [rsp+Ch] [rbp-34h] BYREF
  char v9[3]; // [rsp+Fh] [rbp-31h] BYREF
  char v10[3]; // [rsp+12h] [rbp-2Eh] BYREF
  char v11[3]; // [rsp+15h] [rbp-2Bh] BYREF
  char v12[3]; // [rsp+18h] [rbp-28h] BYREF
  char v13[3]; // [rsp+1Bh] [rbp-25h] BYREF
  char v14[3]; // [rsp+1Eh] [rbp-22h] BYREF
  char v15[3]; // [rsp+21h] [rbp-1Fh] BYREF
  char v16[20]; // [rsp+24h] [rbp-1Ch] BYREF
  unsigned __int64 v17; // [rsp+38h] [rbp-8h]

  v17 = __readfsqword(0x28u);
  fgets(s, 41, _bss_start);
  v16[4] = 0;
  if ( strlen(s) != 40 )  //flag cÃ³ length = 40
    bad();
  if ( strncmp(v14, "d94", 3uLL) )
    bad();
  if ( strncmp(v6, "db_", 3uLL) )
    bad();
  if ( strncmp(v10, "35t", 3uLL) )
    bad();
  if ( strncmp(v8, "y0u", 3uLL) )
    bad();
  if ( strncmp(v7, "1s_", 3uLL) )
    bad();
  if ( strncmp(v13, "d_6", 3uLL) )
    bad();
  if ( strncmp(v5, "g{g", 3uLL) )
    bad();
  if ( strncmp(v11, "_fr", 3uLL) )
    bad();
  if ( v16[3] != 125 )
    bad();
  if ( strncmp(v12, "13n", 3uLL) )
    bad();
  if ( strncmp(v16, "fa6", 3uLL) )
    bad();
  if ( strncmp(v9, "r_b", 3uLL) )
    bad();
  if ( strncmp(v15, "620", 3uLL) )
    bad();
  if ( strncmp(s, "fla", 3uLL) )
    bad();
  puts("Nice job! Submit your answer as the flag.");
  return 0;
}
```

BÃ i check `length` cá»§a flag vÃ  cÃ¡c `subflag` vá»›i cÃ¡c `string`, náº¿u khÃ´ng thá»a mÃ£n 1 cÃ¢u lá»‡nh if nÃ o sáº½ gá»i hÃ m `bad()`

Flag: `flag{gdb_1s_y0ur_b35t_fr13nd_6d94620fa6}` -> Done vá»›i thá»­ thÃ¡ch Ä‘áº§u nhÃ©ğŸ¥¸

### 2: advanced-flag-checker (Solved)

![title 2](/src/2022/Wreckctf/advanced-flag-checker/img/00_title.png)

Tiáº¿p tá»¥c vá»›i IDA:

![open ida pro](/src/2022/Wreckctf/advanced-flag-checker/img/01_open_ida.png)

Ta nháº­n ra hÃ m main cÃ³ gá»i function `sys_write` Ä‘á»ƒ in ra thÃ´ng bÃ¡o cáº§n nháº­p `flag` vÃ  Ä‘á»c flag nháº­p vÃ o.
Tiáº¿p theo chÆ°Æ¡ng trÃ¬nh sá»­ dá»¥ng toÃ¡n tá»­ `XOR` cho láº§n lÆ°á»£t `4 byte` cá»§a `input` vá»›i giÃ¡ trá»‹ tÆ°Æ¡ng á»©ng cá»§a Ä‘á» bÃ i vÃ  so sÃ¡nh giÃ¡ trá»‹ yÃªu cáº§u.

Váº­y cÅ©ng khÃ¡ dá»… Ä‘á»ƒ giáº£i quyáº¿t bÃ i nÃ yğŸ«¡. Nháº¯c láº¡i kiáº¿n thá»©c `XOR` 1 chÃºt lÃ  náº¿u: `A xor Value Ä‘Ã£ biáº¿t = value nÃ o Ä‘Ã³ Ä‘Ã£ biáº¿t` thÃ¬ ta chá»‰ váº§n `xor vá»›i 2 value Ä‘Ã£ biáº¿t` Ä‘Ã³ vá»›i nhau thÃ¬ ta sáº½ tÃ¬m Ä‘Æ°á»£c `A`

DÆ°á»›i Ä‘Ã¢y lÃ  code cá»§a tÃ´i vá» bÃ i nÃ y:

```python
# TÃ´i táº¡o 1 hÃ m reverse láº¡i káº¿t quáº£ nháº­n Ä‘Æ°á»£c sau khi xor 2 giÃ¡ trá»‹ Ä‘Ã£ biáº¿t
def rever(a1,a2):
    a = hex(a1 ^ a2)[2:]
    lst = [chr(int(a[6:8],16)),chr(int(a[4:6],16)),chr(int(a[2:4],16)),chr(int(a[:2],16))] 
    # táº¡o list Ä‘Æ°á»£c chuyá»ƒn ngÆ°á»£c vÃ¬ nÃ³ ngáº¯n nÃªn tÃ´i lÃ m tháº¿ nÃ o vÃ¬ code xáº¥u ae ta thÃ´ng cáº£m nhÃ©, máº¥y giáº£i má»›i sáº½ ngon hÆ¡n ğŸ«¡
    return ''.join(lst) # tráº£ vá» chuá»—i

print(rever(0x558C4DC,0x6239A8BA),end='')
print(rever(0x71100C9B,0x17F64E0),end='')
print(rever(0xCE3D1DDE,0xA14442BB),end='')
print(rever(0x322958FC,0x415C0789),end='')
print(rever(0x8CBE8F4E,0xF6E1EB2B),end='')
print(rever(0xB14A374B,0xDE2C6878),end='')
print(rever(0xEE9707A,0x669D2F08),end='')
print(rever(0xF98DDD38,0xC8D2AE51),end='')
print(rever(0x5D715F4D,0x6C12677F),end='')
print(rever(0x410B9F90,0x3C3CFBA3),end='')
```

CÃ³ 1 lÆ°u Ã½ lÃ  káº¿t quáº£ nháº­n Ä‘Æ°á»£c 4 bytes liÃªn tiáº¿p nhau thÃ¬ ta cáº§n tÃ¡ch nÃ³ ra thÃ nh. NhÆ°ng kiáº¿t quáº£ nháº­n Ä‘Æ°á»£c bá»‘ trÃ­ theo kiá»ƒu **Little-endian** -  1 dáº¡ng sáº¯p xáº¿p cÃ¡c giÃ¡ trá»‹ Ã­t quan trá»ng nháº¥t Ä‘Æ°á»£c lÆ°u trá»¯ trÆ°á»›c. VÃ­ dá»¥ nÃ y cho dá»… hiá»ƒu nhÃ©.ğŸ˜

Náº¿u sá»‘ ta cÃ³ lÃ  `0xFFAA0322` thÃ¬ sáº½ Ä‘Æ°á»£c sáº¯p xáº¿p lÃ  `22 03 AA FF` vÃ¬ náº¿u láº¥y 1 bytes thÃ¬ quan trá»ng nháº¥t lÃ  `22` cÃ²n láº¡i vá» sau sáº½ khÃ´ng quan trá»ng pháº£i khÃ´ng, cÃ²n náº¿u láº¥y nhiá»u hÆ¡n thÃ¬ tiáº¿p tá»¥c (nhá»¯ng cÅ©ng cháº¯c cháº¯n sá»‘ Ä‘Ã³ sáº½ to rá»“iğŸ˜œ mÃ  ta thÆ°á»ng sá»­ dá»¥ng cÃ¡c sá»‘ bÃ© thÃ¬ sáº½ thuáº­n tiá»‡n hÆ¡n thÃ¬ pháº£i). ÄÃ¢y lÃ  áº£nh minh há»a vÃ  cÅ©ng lÃ  káº¿t thÃºc cá»§a thá»­ thÃ¡ch 2 nhÃ©:

![little endian](/src/2022/Wreckctf/advanced-flag-checker/img/02_little_endian.webp)

Ã€ mÃ  quÃªn flag Ä‘Ã¢y nhÃ¡: `flag{hope_you_used_z3_for_this_128c13d7}`.

### 3: reverser (Solved)

![title 3](/src/2022/Wreckctf/reverser/img/00_title.png)

Vá»›i thá»­ thÃ¡ch nÃ y code báº±ng python:

```python

#!/usr/local/bin/python

import os

def check_license(license):         #check license cá»§a mÃ¬nh vá»›i target Ä‘Ã£ Ä‘Æ°á»£c thay Ä‘á»•i qua 1 2 3 ...
    characters = set('0123456789abcdef')
    s = [9]
    for c in license:
        if c not in characters:
            return False
        s.append((s[-1] + int(c, 16)) % 16)  # Ä‘áº¡i láº¡i lÃ  láº¥y sá»‘ dÆ° cá»§a (cÃ¡i trÆ°á»›c + cÃ¡i sau) vá»›i 16
    target = '51c49a1a00647b037f5f3d5c878eb656'
    return ''.join(f'{c:x}' for c in s[1:]) == target #káº¿t quáº£ list vá»«a nháº­n Ä‘Æ°á»£c sáº½ táº¡o thÃ nh chuá»—i Ä‘em so sÃ¡nh vá»›i target náº¿u thá»a mÃ£n tráº£ vá» true

print('welcome to reverser as a service!')
license = input('please enter your license key: ') #nháº­n input license cá»§a mÃ¬nh

if not check_license(license):
    print('sorry, incorrect key!')
    exit()

string = input('what should i reverse? ')
print(f'output: {string[::-1]}') # cho vÃ o cho vui))))
print(os.environ.get('FLAG', 'no flag given')) # náº¿u khÃ´ng exit() á»Ÿ trÃªn thÃ¬ cháº¯c cháº¯n cÃ³ flag rá»“i

```

VÃ  Ã½ tÆ°á»Ÿng nhÆ° Ä‘Ã£ phÃ¢n tÃ­ch Ä‘Ã³ tÃ´i Ä‘Ã£ viáº¿t `keygen` cho chÆ°Æ¡ng trÃ¬nh nÃ y nhÃ©: (vá»›i input Ä‘áº§u vÃ o nhÆ° trÃªn lÃ  target Ä‘Ã³ vÃ  output Ä‘Æ°Æ¡ng nhiÃªn lÃ  `license` chÃ­nh hiá»‡u cáº§n tÃ¬m rá»“i)

```python
license_enc = input("\nInput lincense encode: ")
# license_enc = "51c49a1a00647b037f5f3d5c878eb656"

lst_lin_enc = [9]
for i in license_enc:
    lst_lin_enc.append(int(i,16))

# [9, 5, 1, 12, 4, 9, 10, 1, 10, 0, 0, 6, 4, 7, 11, 0, 3, 7, 15, 5, 15, 3, 13, 5, 12, 8, 7, 8, 14, 11, 6, 5, 6]

lst = []
for i in range(len(lst_lin_enc)-1,0,-1):  # reverse láº¡i cÃ¡c hÃ m chÆ°Æ¡ng trÃ¬nh chÃ­nh lÃ m thÃ´i)))
    temp = lst_lin_enc[i]-lst_lin_enc[i-1]
    if temp <0:
        temp += 16
    lst.append(temp)

print("License: ", end='')
print(''.join(hex(i)[2:] for i in lst)[::-1]) 
```

VÃ  káº¿t quáº£ nÃ³ sáº½ tháº¿ nÃ y:

![result license](/src/2022/Wreckctf/reverser/img/01_result_license.png)

VÃ  nÃ©m cÃ¡i `license` nháº­n Ä‘Æ°á»£c lÃªn vÃ  nháº­n káº¿t quáº£ thÃ´i:

![flag](/src/2022/Wreckctf/reverser/img/02_flag.png)

Váº«n nhÆ° thÆ°á»ng lá»‡ Flag: `flag{clock_math_too_hard}`

### 4: my-frob (Solved)

![title](/src/2022/Wreckctf/my-frob/img/00_title.png)

Má»Ÿ *IDA* vÃ  kiáº¿m hÃ m `main` thÃ´i cÃ¡c pro:

![open](/src/2022/Wreckctf/my-frob/img/01_func_main.png)

CÃ³ má»™t sá»‘ hÃ m Ä‘Ã¡ng chÃº Ã½ nhÆ° lload_flag():

![show func load flag](/src/2022/Wreckctf/my-frob/img/02_func_open_flag.png)

Giáº£i thÃ­ch 1 chÃºt vá» hÃ m nÃ y:

- má»Ÿ file `flag.txt` vá»›i quyá»n read;
- The C library function `int fseek(FILE *stream, long int offset, int whence)` sets the file position of the stream to the given offset. (Äáº·t vá»‹ trÃ­ file stream thÃ nh pháº§n bÃ¹ Ä‘Ã£ cho) - tÃ´i hiá»ƒu nÃ³ lÃ  Ä‘á»c bao nhiÃªu kÃ½ tá»± tá»« vá»‹ trÃ­ nÃ oğŸ˜;
- The C library function `long int ftell(FILE *stream)` - dÃ¹ng Ä‘á»ƒ láº¥y tá»•ng kÃ­ch thÆ°á»›c cá»§a tá»‡p sau khi di chuyá»ƒn con trá» tá»‡p á»Ÿ cuá»‘i tá»‡p. NhÆ° trong bÃ i lÃ  láº¥y kÃ­ch thÆ°á»›c cá»§a `flag` trong file `flag.txt`.

Tiáº¿p tá»¥c ta Ä‘i vÃ o hÃ m `my_memfrob`:

![func my_mem](/src/2022/Wreckctf/my-frob/img/03_func_my_mem.png)

Dá»… nháº­n tháº¥y hÃ m nÃ y sáº½ XOR láº§n lÆ°á»£t cÃ¡c phÃ¢n tá»­ cá»§a `flag` vá»›i giÃ¡ trá»‹ truyá»n vÃ o lÃ  `a3`.

Quay láº¡i hÃ m `main` thÃ¬ ta tháº¥y hÃ m nÃ y sáº½ gá»i láº¡i hÃ m `my_memfrob` 1 vÃ i láº§n náº¿u `v7` váº«n khÃ¡c 233.

![main](/src/2022/Wreckctf/my-frob/img/01_func_main.png)

Ta tháº¥y giÃ¡ trá»‹ ban Ä‘áº§u cá»§a `v7 = 1` sau khi gá»i hÃ m nÃ³ sáº½ Ä‘Æ°á»£c lÆ°u táº¡m vÃ o `v5` vÃ  sáº½ cá»™ng thÃªm vá»›i giÃ¡ trá»‹ `v8`, rá»“i ta tháº¥y `v8 = v5` gÃ¡n láº¡i giÃ¡ trá»‹ v7 chá»©ng tá» `v7` sau báº±ng tá»•ng cá»§a 2 sá»‘ v7 trÆ°á»›c cá»™ng láº¡i.

Cá»™ng vá»›i káº¿t quáº£ Ä‘Ã£ Ä‘Æ°á»£c encode nháº­n Ä‘Æ°á»£c:

![encode](/src/2022/Wreckctf/my-frob/img/04_show_flag_encode.png)

Giá» tÃ´i code decode thÃ´i:

```python
#nháº­n káº¿t quáº£ tá»« trÃªn nc ....
flag_encode = "af a5 a8 ae b2 a5 a0 a7 bc b1 96 ba a1 a6 bc a5 ad 96 a8 ad ad 96 a4 b0 96 a4 ac a4 af bb a6 ab b4"

lst_from_flag = flag_encode.split(" ") # tÃ¡ch vÃ  chuyá»ƒn thÃ nh list

lst_int_fe = []
for i in lst_from_flag:
    lst_int_fe.append(int(i,16))

# [175, 165, 168, 174, 178, 165, 160, 167, 188, 177, 150, 186, 161, 166, 188, 165, 173, 150, 168, 173, 173, 150, 164, 176, 150, 164, 172, 164, 175, 187, 166, 171, 180]

v7 = [1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144][::-1] # list cÃ¡c sá»‘ xor nÃªn ngÆ°á»£c láº¡i lÃ  ...

for i in lst_int_fe:
    for j in v7:
        i = i ^ j
    print( chr(i) ,end='')
```

VÃ  káº¿t quáº£ nháº­n Ä‘Æ°á»£c lÃ  flag: `flag{linux_should_add_my_memfrob}`. Váº­y lÃ  káº¿t thÃºc 4 challenges Ä‘Ã£ giáº£i Ä‘Æ°á»£c qua mÃ¹a giáº£i nÃ y nhÃ©.

<!-- ### 5: no-peeking (Unsolved)

### 6: hopper (Unsolved) -->
