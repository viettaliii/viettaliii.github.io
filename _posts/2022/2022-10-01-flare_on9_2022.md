---
title: Writeup Flare-on9 2022 
author: vietzettt
date:  2022-10-1 
layout: post
published: true
cover: /src/2022/Flare-on9/00_img_pages/FlareOn_Logo.svg
---

---

##### **Ngu·ªìn ·ªü ƒë√¢y nh√° c√°c b·∫°n:** [üíÄ**üëÜüëÜüëÜ**üíÄ](https://www.mandiant.com/resources/blog/flareon9-challenge-solutions)

Xin ch√†o c√°c b·∫°n ƒë·∫øn v·ªõi writeupp l·∫ßn n√†y. L·∫ßn ƒë·∫ßu g√† con v√†o ƒë·∫£o c·ªßa c√°c l√£nh l√†ng s·∫Ω nh∆∞ th·∫ø n√†o nh·ªâ? H·ªët ho·∫£ng th·∫≠t s·ª± h√≠ h√≠...
Sau qu√° tr√¨nh nghi√™n c·ª©u v√† t√¨m hi·ªÉu t√¥i s·∫Ω vi·∫øt ho√†n th√†nh t·∫•t c·ªßa c√°c chall c·ªßa m√πa gi·∫£i nƒÉm nay cho mn ƒë∆∞·ª£c tham kh·∫£o nh√©. ([Link](https://nextheia.com/tags/flare-on-9-write-up/))

Ok b·∫Øt ƒë·∫ßu th√¥i... g√©t g√¥...

### 1: Flaredle (Solved)

Description:

```text
Welcome to Flare-On 9!

You probably won't win. Maybe you're like us and spent the year playing Wordle. We made our own version that is too hard to beat without cheating.

Play it live at: http://flare-on.com/flaredle/
```

![title](/src/2022/Flare-on9/01_Flaredle/00_titile.png)
Ch√∫ng ta ƒë∆∞·ª£c nh·∫≠n 4 file. ƒê·∫ßu ti√™n s·∫Ω m·ªü file ƒëu√¥i `.html` ƒë·ªÉ xem n·ªôi dung hi·ªán th·ªã l√† g√¨? Ta th·∫•y n√≥ s·ª≠ d·ª•ng `js` ƒë∆∞·ª£c cung c·∫•p s·∫µn. Th·∫ø n√™n l√† t√¥i m·ªü file `js` check xem h·ªç vi·∫øt g√¨ v√† d·∫•u g√¨ ·ªü ƒë√≥.
Xem qua ta th·∫•y c√≥ h√†m `if` ki·ªÉm tra chu·ªói t·ª´ ng∆∞·ªùi d√πng v√† chu·ªói flag n·∫±m trong file `script.js`:
![function check](/src/2022/Flare-on9/01_Flaredle/01_function_check.png)
Ta t√¨m ki·∫øm `rightGuessString` xem n√≥ l√† g√¨??
![var right](/src/2022/Flare-on9/01_Flaredle/02_var_rightguessstring.png)
Ok nh·∫≠n th·∫•y bi·∫øn n√†y ƒë∆∞·ª£c l·∫•y t·ª´ th·ª© `57` trong file `words.js`. T·ª´ ƒë√≥ ta nh·∫≠n ƒë∆∞·ª£c: `flareonisallaboutcats`. Ki·ªÉm tra l·∫°i tr√™n web th·ªèa m√£n.
![check result](/src/2022/Flare-on9/01_Flaredle/03_check_result.png)

### 2: PixelPocker (Solved)

Description

```text
I said you wouldn't win that last one. I lied. The last challenge was basically a captcha. Now the real work begins. Shall we play another game?
```

C√¥ng c·ª• ƒë∆∞·ª£c s·ª≠ d·ª•ng:

- CFF Explorer
- IDA Pro
- Python
  - PIL: pip install pillow (1 fork t·ª´ th∆∞ vi·ªán PIL c·ªßa python ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ x·ª≠ l√Ω h√¨nh ·∫£nh)

N·ªôi dung c·ªßa `readme.txt`

```text
Welcome to PixelPoker ^_^, the pixel game that's sweeping the nation!

Your goal is simple: find the correct pixel and click it

Good luck!
```

ƒê·∫ßu ti√™n ta m·ªü b·∫±ng `CFF Explorer` quan s√°t metadata c·ªßa file exe. V√† ta c√≥ ch√∫ √Ω v·ªÅ resourse l√† d·∫°ng Bitmaps (·∫£nh) g·ªìm 2 b·ª©c ·∫£nh v·ªõi t√™n 129 v√† 133.
![check metadata](/src/2022/Flare-on9/02_PixelPocker/00_check_cff.png)
Ch∆∞∆°ng tr√¨nh h∆∞·ªõng ƒë·∫øn vi·ªác c·∫ßn ph·∫£i l∆∞·∫° ch·ªçn 1 ƒëi·ªÉm ·∫£nh v·ªõi t·ªça ƒë·ªô hi·ªán th·ªã tr√™n c·ª≠a s·ªï v√† c√≥ ƒë·ªëi ta 10 l·∫ßn th·ª≠.
![open file](/src/2022/Flare-on9/02_PixelPocker/00_open_file.png)

v√† t√¥i th·ª≠ xem ra k·∫øt qu·∫£ l√† g√¨:
![test](/src/2022/Flare-on9/02_PixelPocker/01_result_test_1.png)
Ta nh·∫≠n ƒë∆∞·ª£c th√¥ng b√°o `Womp womp...:(`. R·ªìi ch√∫ng ta s·∫Ω m·ªü ch√∫ng b·∫±ng IDA Pro ki·∫øm strings n√†y n·∫±m ·ªü h√†m n√†o?.
![open ida](/src/2022/Flare-on9/02_PixelPocker/02_open_ida.png)
Ta s·ª≠a ƒë·ªïi l·∫°i t√™n c·ªßa m·ªôt s·ªë bi·∫øn nh·∫≠n di·ªán r·ªìi.
Nh∆∞ ƒë√£ th·∫•y th√¨ ta th·∫•y c√≥ h√†m ki·ªÉm tra 2 v·ªã tr√≠ `x,y` v·ªõi m·ªôt gi√° tr·ªã c√≥ s·∫µn l·∫•y d∆∞ v·ªõi `uX` v√† `uY`.
![see var ux](/src/2022/Flare-on9/02_PixelPocker/03_see_var_ux.png)
Ta c·∫ßn t√¨m hi·ªÉu xem bi·∫øn `dword_413280` l√† g√¨? th√¨ n√≥ n·∫±m trong h√†m `BitBlt` - 1 h√†m th·ª±c hi·ªán truy·ªÅn kh·ªëi bit d·ªØ li·ªáu t∆∞∆°ng ·ª©ng v·ªõi m·ªôt h√¨nh ch·ªØ nh·∫≠t pixel t·ª´ ng·ªØ c·∫£nh thi·∫øt b·ªã ngu·ªìn ƒë√£ ch·ªâ ƒë·ªãnh sang ng·ªØ c·∫£nh thi·∫øt b·ªã ƒë√≠ch.

```C++
BOOL BitBlt(
    [in] HDC   hdc,
    [in] int   x,
    [in] int   y,
    [in] int   cx,
    [in] int   cy,
    [in] HDC   hdcSrc,
    [in] int   x1,
    [in] int   y1,
    [in] DWORD rop
);
```

Do ƒë√≥ `dword_413280` l√† `cx` - l√† chi·ªÅu r·ªông c·ªßa ngu·ªìn (·ªü tr∆∞·ªùng h·ª£p n√†y l√† h√¨nh ·∫£nh); c√≤n `cy` - l√† chi·ªÅu cao c·ªßa h√¨nh ·∫£nh.

```text
[in] cx
The width, in logical units, of the source and destination rectangles.

[in] cy
The height, in logical units, of the source and the destination rectangles.
```

![so sanh](/src/2022/Flare-on9/02_PixelPocker/04_so_sanh.png)
B∆∞·ªõc so s√°nh ·ªü d√≤ng 43 v√† 46 ki·ªÉm tra gi√° tr·ªã c·ªßa t·ªça ƒë·ªô click chu·ªôt theo tr·ª•c `(x,y)` th·ªèa m√£n ƒëi·ªÅu ki·ªán sau:

x = 0x52414c46 % ƒë·ªô r·ªông ·∫£nh = 0x52414c46 % 741 = 95

y = 0x6e4f2d45 % ƒë·ªô cao ·∫£nh = 0x6e4f2d45 % 641 = 313

Nh∆∞ v·∫≠y ta click ƒë√∫ng t·ªça ƒë·ªô tr√™n th√¨ s·∫Ω chuy·ªÉn sang lu·ªìng kh√°c v√† c√≥ k·∫øt qu·∫£:
![result](/src/2022/Flare-on9/02_PixelPocker/05_result.png)

### 3: Magic_8_Ball (Solved)

Description:

```text
You got a question? Ask the 8 ball!
```

ƒê·∫ßu ti√™n ta gi·∫£i n√©n th√¨ ta nh·∫≠n ƒë∆∞·ª£c nhi·ªÅu file kh√¥ng bi·∫øt file n√†o s·∫Ω l√† quan tr·ªçng n√™n ch√∫ng ta tr∆∞·ªõc m·∫Øt ta c·ª© quan t√¢m ch√≠nh v√†o file ch∆∞∆°ng tr√¨nh `.exe` nha.
![giai nen](/src/2022/Flare-on9/03_Magic_8_Ball/00_giai_nen.png)
M·ªü file th·ª±c thi n√™n th·∫•y nh·∫≠p 1 g√¨ ƒë√≥ r·ªìi Enter th√¨ ta nh·∫≠p ƒë∆∞·ª£c c√°c th√¥ng ƒëi·ªáp v√† nh·∫•n c√°c m≈©i t√™n th√¨ ta th·∫•y qu·∫£ b√≥ng l·∫Øc:
![open](/src/2022/Flare-on9/03_Magic_8_Ball/01_open.png)
Ta m·ªü n√≥ b·∫±ng `IDA Pro` xem sao nh√°. Th√¨ th·∫•y ƒë∆∞·ª£c c√°c string hi·ªán th·ªã l√∫c n√£y ƒë·ªÅu n·∫±m c√πng 1 h√†m `sub_4012B0`:
![string](/src/2022/Flare-on9/03_Magic_8_Ball/02_string.png)
Ti·∫øp t·ª•c theo d·∫•u xem h√†m n√†o s·∫Ω call ƒë·∫øn h√†m n√†y (ch√∫ng ta s·∫Ω rename l√† `predict_string_func`) th√¨ th·∫•y n√≥ ƒë∆∞·ª£c g·ªçi t·ª´ `sub_4027A0`, c√≥ l·∫Ω ƒë√¢y l√† h√†m main c·ªßa ch∆∞∆°ng tr√¨nh. ƒê·ªÉ √Ω ph√≠a d∆∞·ªõi c√≥ m·ªôt v√≤ng l·∫∑p do while, r·∫•t gi·ªëng v·ªõi v√≤ng l·∫∑p x·ª≠ l√Ω c√°c s·ª± ki·ªán (event) r·∫•t hay g·∫∑p trong c√°c ·ª©ng d·ª•ng GUI.
![main](/src/2022/Flare-on9/03_Magic_8_Ball/03_func_main.png)
ƒêi d·∫°o quanh c√°c h√†m trong v√≤ng l·∫∑p do while th√¨ ta nh·∫≠n ra ƒëo·∫°n n√†y gi·ªëng nh∆∞ ƒëo·∫°n ƒëi·ªÅu h∆∞·ªõng c·ªßa qu·∫£ b√≥ng:
![04](/src/2022/Flare-on9/03_Magic_8_Ball/04.png)
v√† k√©o xu·ªëng d∆∞·ªõi th√¨ l√† c√°c c√¢u l·ªánh ƒëi·ªÅu ki·ªán ki·ªÉm tra l·ªìng nhau. Tr∆∞·ªùng h·ª£p n√†y ta convert c√°c s·ªë `76,85,82,68` sang ki·ªÉu d·ªØ li·ªáu `char`:
![command if](/src/2022/Flare-on9/03_Magic_8_Ball/05_command_if.png)

Ta nh·∫≠n ƒë∆∞·ª£c: `LLURULDUL`. Sau khi ki·ªÉm tra chu·ªói n√†y xong th√¨ s·∫Ω so s√°nh chu·ªói c√≥ ƒë·ªô d√†i 15 k√Ω t·ª±:

```c
result = strncmp(v21, (const char *)(this + 92), 15u);
```

Ta debug t·∫°i IDA lu√¥n ƒëi·ªÅu h∆∞·ªõng qu·∫£ b√≥ng nh∆∞ tr√™n m√¨nh ph√¢n t√≠ch r·ªìi ta nh·∫≠p 1 string n√†o ƒë√≥ r·ªìi ƒë·∫∑t `breakpoint` (F2) t·∫°i h√†m so s√°nh n√†y th√¨ ta nh·∫≠n ƒë∆∞·ª£c nh∆∞ sau:
![debug check](/src/2022/Flare-on9/03_Magic_8_Ball/06_debug_check.png)
Nh∆∞ v·∫≠y ta nh·∫≠n th·∫•y c√≥ 2 c√¢u l·ªánh 3 c√¢u l·ªánh `push` tr∆∞·ªõc khi g·ªçi h√†m `strncmp` c√≥ nghƒ©a l√† truy·ªÅn tham s·ªë v√†o h√†m ƒë√≥ t∆∞∆°ng ·ª©ng: `push` t·ª´ ph·∫£i qua tr√°i -> ta th·∫•y thanh ghi `ecx` s·∫Ω l√† string m√¨nh nh·∫≠p v√† thanh ghi `eax` ch√≠nh l√† ngu·ªìn s·∫Ω so s√°nh.
![eax](/src/2022/Flare-on9/03_Magic_8_Ball/07_check_eax.png)
v√† m·ªçi th·ª© coi nh∆∞ ƒë√£ xong ki·∫øm ƒë∆∞·ª£c string so s√°nh l√†: `gimme flag pls?`
Ch·∫°y l·∫°i ch∆∞∆°ng tr√¨nh, nh·∫≠p ƒë√∫ng chu·ªói ph√≠m ƒë·ªãnh h∆∞·ªõng qu·∫£ b√≥ng v√† nh·∫≠p c√¢u h·ªèi v·ª´a t√¨m ƒë∆∞·ª£c s·∫Ω in ra flag:
![flag](/src/2022/Flare-on9/03_Magic_8_Ball/08_result.png)

```text
U_cRackeD_th1$_maG1cBaLL_!!_@flare-on.com
```

<!-- ### 4: darn_mice

Description:

```text
"If it crashes its user error." - Flare Team

```

### 5: t8

### 6: alamode

### 7: anode

### 8: backdoor

### 9: encryptor

### 10: Nur_getraÃàumt

### 11: the_challenge_that_shall_not_be_named -->
