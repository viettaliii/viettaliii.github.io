---
title: Writeup Flare-on9 2022 
author: vietzettt
date:  2022-10-1 
layout: post
published: true
cover: /src/2022/Flare-on9/00_img_pages/FlareOn_Logo.svg
---

---

##### **Ngu·ªìn ·ªü ƒë√¢y nh√° c√°c b·∫°n:** [üíÄ**üëÜüëÜüëÜ**üíÄ](https://www.mandiant.com/resources/blog/flareon9-challenge-solutions)

Xin ch√†o c√°c b·∫°n ƒë·∫øn v·ªõi writeupp l·∫ßn n√†y. L·∫ßn ƒë·∫ßu g√† con v√†o ƒë·∫£o c·ªßa c√°c l√£nh l√†ng s·∫Ω nh∆∞ th·∫ø n√†o nh·ªâ? H·ªët ho·∫£ng th·∫≠t s·ª± h√≠ h√≠...
Sau qu√° tr√¨nh nghi√™n c·ª©u v√† t√¨m hi·ªÉu t√¥i s·∫Ω vi·∫øt ho√†n th√†nh t·∫•t c·ªßa c√°c chall c·ªßa m√πa gi·∫£i nƒÉm nay cho mn ƒë∆∞·ª£c tham kh·∫£o nh√©. ([Link](https://nextheia.com/tags/flare-on-9-write-up/))

Ok b·∫Øt ƒë·∫ßu th√¥i... g√©t g√¥...

### 1: Flaredle (Solved)

Description:

```text
Welcome to Flare-On 9!

You probably won't win. Maybe you're like us and spent the year playing Wordle. We made our own version that is too hard to beat without cheating.

Play it live at: http://flare-on.com/flaredle/
```

![title](/src/2022/Flare-on9/01_Flaredle/00_titile.png)
Ch√∫ng ta ƒë∆∞·ª£c nh·∫≠n 4 file. ƒê·∫ßu ti√™n s·∫Ω m·ªü file ƒëu√¥i `.html` ƒë·ªÉ xem n·ªôi dung hi·ªán th·ªã l√† g√¨? Ta th·∫•y n√≥ s·ª≠ d·ª•ng `js` ƒë∆∞·ª£c cung c·∫•p s·∫µn. Th·∫ø n√™n l√† t√¥i m·ªü file `js` check xem h·ªç vi·∫øt g√¨ v√† d·∫•u g√¨ ·ªü ƒë√≥.
Xem qua ta th·∫•y c√≥ h√†m `if` ki·ªÉm tra chu·ªói t·ª´ ng∆∞·ªùi d√πng v√† chu·ªói flag n·∫±m trong file `script.js`:
![function check](/src/2022/Flare-on9/01_Flaredle/01_function_check.png)
Ta t√¨m ki·∫øm `rightGuessString` xem n√≥ l√† g√¨??
![var right](/src/2022/Flare-on9/01_Flaredle/02_var_rightguessstring.png)
Ok nh·∫≠n th·∫•y bi·∫øn n√†y ƒë∆∞·ª£c l·∫•y t·ª´ th·ª© `57` trong file `words.js`. T·ª´ ƒë√≥ ta nh·∫≠n ƒë∆∞·ª£c: `flareonisallaboutcats`. Ki·ªÉm tra l·∫°i tr√™n web th·ªèa m√£n.
![check result](/src/2022/Flare-on9/01_Flaredle/03_check_result.png)

### 2: PixelPocker (Solved)

Description

```text
I said you wouldn't win that last one. I lied. The last challenge was basically a captcha. Now the real work begins. Shall we play another game?
```

C√¥ng c·ª• ƒë∆∞·ª£c s·ª≠ d·ª•ng:

- CFF Explorer
- IDA Pro
- Python
  - PIL: pip install pillow (1 fork t·ª´ th∆∞ vi·ªán PIL c·ªßa python ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ x·ª≠ l√Ω h√¨nh ·∫£nh)

N·ªôi dung c·ªßa `readme.txt`

```text
Welcome to PixelPoker ^_^, the pixel game that's sweeping the nation!

Your goal is simple: find the correct pixel and click it

Good luck!
```

ƒê·∫ßu ti√™n ta m·ªü b·∫±ng `CFF Explorer` quan s√°t metadata c·ªßa file exe. V√† ta c√≥ ch√∫ √Ω v·ªÅ resourse l√† d·∫°ng Bitmaps (·∫£nh) g·ªìm 2 b·ª©c ·∫£nh v·ªõi t√™n 129 v√† 133.
![check metadata](/src/2022/Flare-on9/02_PixelPocker/00_check_cff.png)
Ch∆∞∆°ng tr√¨nh h∆∞·ªõng ƒë·∫øn vi·ªác c·∫ßn ph·∫£i l∆∞·∫° ch·ªçn 1 ƒëi·ªÉm ·∫£nh v·ªõi t·ªça ƒë·ªô hi·ªán th·ªã tr√™n c·ª≠a s·ªï v√† c√≥ ƒë·ªëi ta 10 l·∫ßn th·ª≠.
![open file](/src/2022/Flare-on9/02_PixelPocker/00_open_file.png)

v√† t√¥i th·ª≠ xem ra k·∫øt qu·∫£ l√† g√¨:
![test](/src/2022/Flare-on9/02_PixelPocker/01_result_test_1.png)
Ta nh·∫≠n ƒë∆∞·ª£c th√¥ng b√°o `Womp womp...:(`. R·ªìi ch√∫ng ta s·∫Ω m·ªü ch√∫ng b·∫±ng IDA Pro ki·∫øm strings n√†y n·∫±m ·ªü h√†m n√†o?.
![open ida](/src/2022/Flare-on9/02_PixelPocker/02_open_ida.png)
Ta s·ª≠a ƒë·ªïi l·∫°i t√™n c·ªßa m·ªôt s·ªë bi·∫øn nh·∫≠n di·ªán r·ªìi.
Nh∆∞ ƒë√£ th·∫•y th√¨ ta th·∫•y c√≥ h√†m ki·ªÉm tra 2 v·ªã tr√≠ `x,y` v·ªõi m·ªôt gi√° tr·ªã c√≥ s·∫µn l·∫•y d∆∞ v·ªõi `uX` v√† `uY`.
![see var ux](/src/2022/Flare-on9/02_PixelPocker/03_see_var_ux.png)
Ta c·∫ßn t√¨m hi·ªÉu xem bi·∫øn `dword_413280` l√† g√¨? th√¨ n√≥ n·∫±m trong h√†m `BitBlt` - 1 h√†m th·ª±c hi·ªán truy·ªÅn kh·ªëi bit d·ªØ li·ªáu t∆∞∆°ng ·ª©ng v·ªõi m·ªôt h√¨nh ch·ªØ nh·∫≠t pixel t·ª´ ng·ªØ c·∫£nh thi·∫øt b·ªã ngu·ªìn ƒë√£ ch·ªâ ƒë·ªãnh sang ng·ªØ c·∫£nh thi·∫øt b·ªã ƒë√≠ch.

```C++
BOOL BitBlt(
    [in] HDC   hdc,
    [in] int   x,
    [in] int   y,
    [in] int   cx,
    [in] int   cy,
    [in] HDC   hdcSrc,
    [in] int   x1,
    [in] int   y1,
    [in] DWORD rop
);
```

Do ƒë√≥ `dword_413280` l√† `cx` - l√† chi·ªÅu r·ªông c·ªßa ngu·ªìn (·ªü tr∆∞·ªùng h·ª£p n√†y l√† h√¨nh ·∫£nh); c√≤n `cy` - l√† chi·ªÅu cao c·ªßa h√¨nh ·∫£nh.

```text
[in] cx
The width, in logical units, of the source and destination rectangles.

[in] cy
The height, in logical units, of the source and the destination rectangles.
```

![so sanh](/src/2022/Flare-on9/02_PixelPocker/04_so_sanh.png)
B∆∞·ªõc so s√°nh ·ªü d√≤ng 43 v√† 46 ki·ªÉm tra gi√° tr·ªã c·ªßa t·ªça ƒë·ªô click chu·ªôt theo tr·ª•c `(x,y)` th·ªèa m√£n ƒëi·ªÅu ki·ªán sau:

x = 0x52414c46 % ƒë·ªô r·ªông ·∫£nh = 0x52414c46 % 741 = 95

y = 0x6e4f2d45 % ƒë·ªô cao ·∫£nh = 0x6e4f2d45 % 641 = 313

Nh∆∞ v·∫≠y ta click ƒë√∫ng t·ªça ƒë·ªô tr√™n th√¨ s·∫Ω chuy·ªÉn sang lu·ªìng kh√°c v√† c√≥ k·∫øt qu·∫£:
![result](/src/2022/Flare-on9/02_PixelPocker/05_result.png)

### 3: Magic_8_Ball (Solved)

Description:

```text
You got a question? Ask the 8 ball!
```

ƒê·∫ßu ti√™n ta gi·∫£i n√©n th√¨ ta nh·∫≠n ƒë∆∞·ª£c nhi·ªÅu file kh√¥ng bi·∫øt file n√†o s·∫Ω l√† quan tr·ªçng n√™n ch√∫ng ta tr∆∞·ªõc m·∫Øt ta c·ª© quan t√¢m ch√≠nh v√†o file ch∆∞∆°ng tr√¨nh `.exe` nha.
![giai nen](/src/2022/Flare-on9/03_Magic_8_Ball/00_giai_nen.png)
M·ªü file th·ª±c thi n√™n th·∫•y nh·∫≠p 1 g√¨ ƒë√≥ r·ªìi Enter th√¨ ta nh·∫≠p ƒë∆∞·ª£c c√°c th√¥ng ƒëi·ªáp v√† nh·∫•n c√°c m≈©i t√™n th√¨ ta th·∫•y qu·∫£ b√≥ng l·∫Øc:
![open](/src/2022/Flare-on9/03_Magic_8_Ball/01_open.png)
Ta m·ªü n√≥ b·∫±ng `IDA Pro` xem sao nh√°. Th√¨ th·∫•y ƒë∆∞·ª£c c√°c string hi·ªán th·ªã l√∫c n√£y ƒë·ªÅu n·∫±m c√πng 1 h√†m `sub_4012B0`:
![string](/src/2022/Flare-on9/03_Magic_8_Ball/02_string.png)
Ti·∫øp t·ª•c theo d·∫•u xem h√†m n√†o s·∫Ω call ƒë·∫øn h√†m n√†y (ch√∫ng ta s·∫Ω rename l√† `predict_string_func`) th√¨ th·∫•y n√≥ ƒë∆∞·ª£c g·ªçi t·ª´ `sub_4027A0`, c√≥ l·∫Ω ƒë√¢y l√† h√†m main c·ªßa ch∆∞∆°ng tr√¨nh. ƒê·ªÉ √Ω ph√≠a d∆∞·ªõi c√≥ m·ªôt v√≤ng l·∫∑p do while, r·∫•t gi·ªëng v·ªõi v√≤ng l·∫∑p x·ª≠ l√Ω c√°c s·ª± ki·ªán (event) r·∫•t hay g·∫∑p trong c√°c ·ª©ng d·ª•ng GUI.
![main](/src/2022/Flare-on9/03_Magic_8_Ball/03_func_main.png)
ƒêi d·∫°o quanh c√°c h√†m trong v√≤ng l·∫∑p do while th√¨ ta nh·∫≠n ra ƒëo·∫°n n√†y gi·ªëng nh∆∞ ƒëo·∫°n ƒëi·ªÅu h∆∞·ªõng c·ªßa qu·∫£ b√≥ng:
![04](/src/2022/Flare-on9/03_Magic_8_Ball/04.png)
v√† k√©o xu·ªëng d∆∞·ªõi th√¨ l√† c√°c c√¢u l·ªánh ƒëi·ªÅu ki·ªán ki·ªÉm tra l·ªìng nhau. Tr∆∞·ªùng h·ª£p n√†y ta convert c√°c s·ªë `76,85,82,68` sang ki·ªÉu d·ªØ li·ªáu `char`:
![command if](/src/2022/Flare-on9/03_Magic_8_Ball/05_command_if.png)

Ta nh·∫≠n ƒë∆∞·ª£c: `LLURULDUL`. Sau khi ki·ªÉm tra chu·ªói n√†y xong th√¨ s·∫Ω so s√°nh chu·ªói c√≥ ƒë·ªô d√†i 15 k√Ω t·ª±:

```c
result = strncmp(v21, (const char *)(this + 92), 15u);
```

Ta debug t·∫°i IDA lu√¥n ƒëi·ªÅu h∆∞·ªõng qu·∫£ b√≥ng nh∆∞ tr√™n m√¨nh ph√¢n t√≠ch r·ªìi ta nh·∫≠p 1 string n√†o ƒë√≥ r·ªìi ƒë·∫∑t `breakpoint` (F2) t·∫°i h√†m so s√°nh n√†y th√¨ ta nh·∫≠n ƒë∆∞·ª£c nh∆∞ sau:
![debug check](/src/2022/Flare-on9/03_Magic_8_Ball/06_debug_check.png)
Nh∆∞ v·∫≠y ta nh·∫≠n th·∫•y c√≥ 2 c√¢u l·ªánh 3 c√¢u l·ªánh `push` tr∆∞·ªõc khi g·ªçi h√†m `strncmp` c√≥ nghƒ©a l√† truy·ªÅn tham s·ªë v√†o h√†m ƒë√≥ t∆∞∆°ng ·ª©ng: `push` t·ª´ ph·∫£i qua tr√°i -> ta th·∫•y thanh ghi `ecx` s·∫Ω l√† string m√¨nh nh·∫≠p v√† thanh ghi `eax` ch√≠nh l√† ngu·ªìn s·∫Ω so s√°nh.
![eax](/src/2022/Flare-on9/03_Magic_8_Ball/07_check_eax.png)
v√† m·ªçi th·ª© coi nh∆∞ ƒë√£ xong ki·∫øm ƒë∆∞·ª£c string so s√°nh l√†: `gimme flag pls?`
Ch·∫°y l·∫°i ch∆∞∆°ng tr√¨nh, nh·∫≠p ƒë√∫ng chu·ªói ph√≠m ƒë·ªãnh h∆∞·ªõng qu·∫£ b√≥ng v√† nh·∫≠p c√¢u h·ªèi v·ª´a t√¨m ƒë∆∞·ª£c s·∫Ω in ra flag:
![flag](/src/2022/Flare-on9/03_Magic_8_Ball/08_result.png)

```text
U_cRackeD_th1$_maG1cBaLL_!!_@flare-on.com
```

### 4: darn_mice

Description:

```text
"If it crashes its user error." - Flare Team
```

ƒê·ªÅ b√†i cho 1 file `darn_mice.exe`. ƒê·∫ßu ti√™n t√¥i s·∫Ω ki·ªÉm tra c√°c th√¥ng tin c·ªßa file b·∫±ng ph·∫ßn m·ªÅm `Detect It Easy` (vi·∫øt t·∫Øt c·ªßa ch∆∞∆°ng tr√¨nh s·∫Ω l√† `die` m√†u v√†ng) ch√∫ng ta bi·∫øt ƒë∆∞·ª£c ƒë√¢y l√† 1 ·ª©ng d·ª•ng console vi·∫øt b·∫±ng C++.
![open check die](/src/2022/Flare-on9/04_darn_mice/00_open_check_die.png)
T√¥i v√†o console ch·∫°y th·ª≠ kh√¥ng cho tham s·ªë th√¨ kh√¥ng th·∫•y ra g√¨ v√† th√™m tham s·ªë th√¨ c√≥ ra k·∫øt qu·∫£ -> b√†i y√™u c·∫ßu truy·ªÅn tham s·ªë nh∆∞ password n·∫øu ƒë√∫ng s·∫Ω in ra flag g√¨ ƒë√≥.
![open console](/src/2022/Flare-on9/04_darn_mice/01_open_console.png)
ƒê·ªÉ ki·ªÉm tra v√† l√†m t√¥i m·ªü IDA th√¨ ta th·∫•y
![open ida check main](/src/2022/Flare-on9/04_darn_mice/02_open_ida_check_main.png)
Nh∆∞ v·∫≠y h√†m n√†y ch√≠nh x√°c l√† y√™u c·∫ßu ta truy·ªÅn v√†o l√† 2 `argc`.
N·∫øu ƒë·ªß s·∫Ω v√†o ch∆∞∆°ng tr√¨nh ki·ªÉm tra `password`:
![func check pass](/src/2022/Flare-on9/04_darn_mice/03_func_check_pass.png)
·ªû ƒë√¢y ta ph√¢n t√≠ch nh∆∞ sau: (s·ª≠a t√™n l·∫°i ta c√≥ nh∆∞ sau)
![rename](/src/2022/Flare-on9/04_darn_mice/04_rename.png)

- Chu·ªói ta nh·∫≠p th√¨ s·∫Ω g·ªçi l√† `pbPassword`.
- Sau ƒë√≥ s·∫Ω in ra m√†n h√¨nh -> ti·∫øp ƒë·∫øn l√† ki·ªÉm tra k√≠ch th∆∞·ªõc c·ªßa `pbPassword`: `if (!v3 || v3 > 0x23)` ph·∫ßn n√†y check strlen ph·∫£i th·ªèa m√£n t·ªìn t·∫°i v√† kh√¥ng ƒë∆∞·ª£c l·ªõn h∆°n `0x23` n√≥ l√† 35 -> k√≠ch th∆∞·ªõc c·ªßa `pbPassword` l√† `35`:

Ti·∫øp ƒë·∫øn ta ƒë·ªÉ √Ω ƒë·∫øn v√≤ng l·∫∑p for:

- ƒê·∫ßu ti√™n, th·ª±c hi·ªán allocation m·ªôt v√πng nh·ªõ, k√≠ch th∆∞·ªõc 0x1000 l∆∞u v√†o `v2`
- Sau ƒë√≥ l√† l·∫•y t·ª´ng k√Ω t·ª± c·ªßa `pbPassword` ƒëem c·ªông t∆∞∆°ng ·ª©ng v·ªõi v·ªã tr√≠ c·ªßa bi·∫øn `magic` ƒë√£ ƒë∆∞·ª£c khai b√°o v√† g√°n gi√° tr·ªã ·ªü ƒë·∫ßu func.
- G√°n gi√° tr·ªã n√†y cho byte ƒë·∫ßu ti√™n c·ªßa v√πng nh·ªõ v·ª´a ƒë∆∞·ª£c kh·ªüi t·∫°o
- Nh·∫£y ƒë·∫øn v√†o ch·∫°y code t·∫°i v√πng nh·ªõ ƒë√≥ (t∆∞∆°ng ·ª©ng v·ªõi l·ªánh g·ªçi `v2(v2)`)
- in ra chu·ªói `Nibble...`
- Ti·∫øp t·ª•c v√≤ng l·∫∑p

Qua ƒëo·∫°n for n√†y n·∫øu nh·∫≠p ƒë√∫ng, ch∆∞∆°ng tr√¨nh s·∫Ω d√πng password n√†y ƒë·ªÉ decrypt ra flag

V·∫≠y l√† b√†i to√°n ƒë·∫∑t ra l√† x√¢y d·ª±ng code l√†m sao ƒë·ªÉ th·ª±c hi·ªán ƒë√∫ng 1 l·ªánh assembly (opcode) ƒë·ªÉ ch∆∞∆°ng tr√¨nh kh√¥ng b·ªã crash v√† sau ƒë√≥ l·∫°i quay l·∫°i th·ª±c hi·ªán theo flow c≈© c·ªßa ch∆∞∆°ng tr√¨nh (ti·∫øp t·ª•c in ra d√≤ng `Nubble...`).

![debug](/src/2022/Flare-on9/04_darn_mice/05_debug.png)

T√¥i th·ª≠ v·ªõi pass l√† `123456789`. Ta th·∫•y d√≤ng code v·ªã tr√≠ `.text:01011155` l√† n√≥ c·ªông r·ªìi l∆∞u v√†o thanh ghi `ecx`; ti·∫øp theo mov ƒë·ªãa ch·ªâ √¥ nh·ªõ s·∫Ω g·ªçi cho thanh ghi `edx`. Khi g·ªçi v√†o v√πng nh·ªõ, g·∫∑p `opcode` n√†o ƒë√≥ ƒë·ªÉ ngay l·∫≠p t·ª©c quay l·∫°i ƒë·ªÉ ti·∫øp t·ª•c flow c≈© ch·∫°y nh∆∞ b√¨nh th∆∞·ªùng.

![06](/src/2022/Flare-on9/04_darn_mice/06.png)

Nh∆∞ v·∫≠y `hex(ord('1') + ord('P')) = '0x81'` n√≥ l√† c√¢u l·ªánh add ))). Th·ª≠ k·∫øt qu·∫£ l√† `NOP` th√¨ code l·∫°i ch·∫°y ti·∫øp t·ª•c trong v√πng nh·ªõ ƒë√≥ v√† b√°o l·ªói, v√† th·ª≠ `opcode RET = 'C3'` c√¢u l·ªánh cu·ªëi c·ªßa m·ªói h√†m th√¨ n√≥ tr·ªü v·ªÅ v√† xong.

![retn](/src/2022/Flare-on9/04_darn_mice/07_retn.png)

Gi·ªù vi·∫øt m√† code ƒë·ªÉ t√¨m pass nh√°:

```py
str_magic = [0x50, 0x5E, 0x5E, 0xA3, 0x4F, 0x5B, 0x51, 0x5E, 0x5E, 0x97, 0xA3, 0x80, 0x90, 0xA3, 0x80, 0x90, 0xA3, 0x80, 0x90, 0xA3, 0x80, 0x90, 0xA3, 0x80, 0x90, 0xA3, 0x80, 0x90, 0xA3, 0x80, 0x90, 0xA2, 0xA3, 0x6B, 0x7F]
password = "".join([chr(0xC3 - m) for m in str_magic])
print(password)
#see three, C3 C3 C3 C3 C3 C3 C3! XD
```

V√† ch·∫°y password v·ª´a t√¨m ƒë∆∞·ª£c th√¨ ta nh·∫≠n ƒë∆∞·ª£c:
![result](/src/2022/Flare-on9/04_darn_mice/08_result.png)

Xong flag s·∫Ω l√†: `i_w0uld_l1k3_to_RETurn_this_joke@flare-on.com`

### 5: t8

```text
FLARE FACT #823: Studies show that C++ Reversers have fewer friends on average than normal people do. That's why you're here, reversing this, instead of with them, because they don't exist.

We‚Äôve found an unknown executable on one of our hosts. The file has been there for a while, but our networking logs only show suspicious traffic on one day. Can you tell us what happened?

7-zip password: flare
```

Ta nh·∫≠n ƒë∆∞·ª£c 2 file `t8.exe` v√† `trafic.pcapng` - file ch·ª©a c√°c th√¥ng tin networking log c·ªßa file nghi ng·ªù.  S·ª≠ d·ª•ng `Wireshark` ƒë·ªÉ quan s√°t t·∫≠p tin ch·ª©a d·ªØ li·ªáu m·∫°ng.

ƒê·ªëi v·ªõi TCP Stream l√† lo·∫°i HTTP th√¨ Wireshark cho ph√©p thao t√°c ƒë·ªÉ l·∫•y d·ªØ li·ªáu trong tr∆∞·ªùng data c·ªßa method POST m·ªôt c√°ch d·ªÖ d√†ng.

Quay tr·ªü l·∫°i v·ªõi file `t8.exe`, ƒë·ªÉ b∆∞·ªõc v√†o ph√¢n t√≠ch th√¨ c·∫ßn ki·ªÉm tra m·ªôt s·ªë th√¥ng tin c·∫ßn thi·∫øt li√™n quan. ƒê·ªçc metadata s·ª≠ d·ª•ng `CFF Explorer` cho th·∫•y t·∫≠p tin l√† **PE32** v√† c√≥ kh·∫£ nƒÉng l√† s·ª≠ d·ª•ng ch∆∞∆°ng tr√¨nh bi√™n d·ªãch l√† VS C++. Do ƒë√≥ c·∫ßn s·ª≠ d·ª•ng c√¥ng c·ª• nh∆∞ x64dbg, IDA Pro ho·∫∑c Ghidra ƒë·ªÉ ph√¢n t√≠ch tƒ©nh v√† ƒë·ªông.

Trong h√†m main c√≥ ki·ªÉm tra ƒëi·ªÅu ki·ªán:

```c
while ( sub_404570(xmmword_45088C, DWORD1(xmmword_45088C), DWORD2(xmmword_45088C), HIDWORD(xmmword_45088C)) != 15 )
    Sleep(0x2932E00u);
```

Ta ki·ªÉm tra xem `xmmword_45088C` bi·∫øn n√†y l√† g√¨? Ki·ªÉm tra xem xref c√°c c√°c ƒë·ªãa ch·ªâ `xmmword_45088C`, th√¨ ki·∫øm ƒë∆∞·ª£c h√†m `sub_401020()` kh·ªüi t·∫°o gi√° tr·ªã n√†y. Bi·∫øn n√†y ƒë∆∞·ª£c gn√° b·∫±ng th·ªùi gian hi·ªán t·∫°i c·ªßa ch∆∞∆°ng tr√¨nh l√∫c th·ª±c thi.

```c
int sub_401020()
{
  struct _SYSTEMTIME SystemTime; // [esp+4h] [ebp-20h] BYREF
  int v2; // [esp+20h] [ebp-4h]

  v2 = 0;
  sub_405930(&dword_450874, L"FO9", 3);
  GetLocalTime(&SystemTime);
  srand(SystemTime.wMilliseconds + 1000 * (SystemTime.wSecond + 60 * SystemTime.wMinute));
  dword_450870 = rand();
  xmmword_45088C = (__int128)SystemTime;
  return atexit(sub_43DC50);
}
```

Ti·∫øp ƒë·∫øn l√† ƒëi s√¢u v√†o h√†m `sub_404570` th√¨ ƒë∆∞·ª£c:

```c
int __cdecl sub_404570(unsigned int a1, unsigned int a2)
{
  unsigned int v2; // ecx
  int v3; // esi
  unsigned int v4; // eax
  float v5; // xmm0_4
  float v9; // [esp+2Ch] [ebp+14h]

  v2 = HIWORD(a1);
  v3 = (unsigned __int16)a1 - 1;
  if ( HIWORD(a1) > 2u )
    v3 = (unsigned __int16)a1;
  v4 = v2 + 12;
  if ( v2 > 2 )
    v4 = HIWORD(a1);
  v9 = (float)((float)((double)(int)(v3 / 100 / 4
                                   + HIWORD(a2)
                                   + (int)((double)(v3 + 4716) * 365.25)
                                   - (int)((double)(int)(v4 + 1) * -30.6001)
                                   - v3 / 100
                                   + 2)
                     - 1524.5)
             - 2451549.5)
     / 29.53;
  v5 = floor(v9);
  return (int)roundf((float)(v9 - v5) * 29.53);
}
```

C√≥ c√°c con s·ªë l·∫° th√¨ ta tra google xem n√≥ l√† g√¨ th√¨ nh·∫≠n th·∫•y ƒë√¢y l√† h√†m t√≠nh to√°n c√≥ li√™n quan t·ªõi x√°c ƒë·ªãnh chu k√¨ m·∫∑t trƒÉng (Moon phase). V·ªõi k·∫øt qu·∫£ `sub_404570() ==15` th√¨ c√≥ th·ªÉ x√°c ƒë·ªãnh l√† th·ªùi ƒëi·ªÉm hi·ªán t·∫°i l√† ng√†y r·∫±m (trƒÉng tr√≤n).

ƒê·ªÉ v∆∞·ª£t qua ki·ªÉm tra th√¨ ƒë∆°n gi·∫£n l√† ta ch·ªânh l·∫°i th·ªùi gian ng√†y l√† ng√†y r·∫±m (full moon).

Ch·∫°y ch∆∞∆°ng tr√¨nh v√† b·∫Øt d·ªØ li·ªáu m·∫°ng b·∫±ng Wireshark ta bi·∫øt t8.exe s·∫Ω ph√¢n gi·∫£i t√™n mi·ªÅn flare-on.com v√† k·∫øt n·ªëi b·∫±ng giao th·ª©c HTTP.

(ti·∫øp s·∫Ω c√≥ sau)

<!-- ### 6: alamode

### 7: anode

### 8: backdoor

### 9: encryptor

### 10: Nur_getraÃàumt

### 11: the_challenge_that_shall_not_be_named -->

<!-- 
https://sec.vnpt.vn/2022/11/flare-on-9-writeup-part2-chal8-11/
https://sec.vnpt.vn/2022/11/flare-on-9-writeup-part1-chal1-7/
 -->