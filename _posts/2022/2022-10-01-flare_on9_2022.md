---
title: Writeup Flare-on9 2022 
author: vietzettt
date:  2022-10-1 
layout: post
published: true
cover: /src/2022/Flare-on9/00_img_pages/FlareOn_Logo.svg
---

---

##### **Nguá»“n á»Ÿ Ä‘Ã¢y nhÃ¡ cÃ¡c báº¡n:** [ğŸ’€**ğŸ‘†ğŸ‘†ğŸ‘†**ğŸ’€](https://www.mandiant.com/resources/blog/flareon9-challenge-solutions)

Xin chÃ o cÃ¡c báº¡n Ä‘áº¿n vá»›i writeupp láº§n nÃ y. Láº§n Ä‘áº§u gÃ  con vÃ o Ä‘áº£o cá»§a cÃ¡c lÃ£nh lÃ ng sáº½ nhÆ° tháº¿ nÃ o nhá»‰? Há»‘t hoáº£ng tháº­t sá»± hÃ­ hÃ­...
Sau quÃ¡ trÃ¬nh nghiÃªn cá»©u vÃ  tÃ¬m hiá»ƒu tÃ´i sáº½ viáº¿t hoÃ n thÃ nh táº¥t cá»§a cÃ¡c chall cá»§a mÃ¹a giáº£i nÄƒm nay cho mn Ä‘Æ°á»£c tham kháº£o nhÃ©. ([Link](https://nextheia.com/tags/flare-on-9-write-up/))

Ok báº¯t Ä‘áº§u thÃ´i... gÃ©t gÃ´...

### 1: Flaredle (Solved)

Description:

```text
Welcome to Flare-On 9!

You probably won't win. Maybe you're like us and spent the year playing Wordle. We made our own version that is too hard to beat without cheating.

Play it live at: http://flare-on.com/flaredle/
```

![title](/src/2022/Flare-on9/01_Flaredle/00_titile.png)
ChÃºng ta Ä‘Æ°á»£c nháº­n 4 file. Äáº§u tiÃªn sáº½ má»Ÿ file Ä‘uÃ´i `.html` Ä‘á»ƒ xem ná»™i dung hiá»‡n thá»‹ lÃ  gÃ¬? Ta tháº¥y nÃ³ sá»­ dá»¥ng `js` Ä‘Æ°á»£c cung cáº¥p sáºµn. Tháº¿ nÃªn lÃ  tÃ´i má»Ÿ file `js` check xem há» viáº¿t gÃ¬ vÃ  dáº¥u gÃ¬ á»Ÿ Ä‘Ã³.
Xem qua ta tháº¥y cÃ³ hÃ m `if` kiá»ƒm tra chuá»—i tá»« ngÆ°á»i dÃ¹ng vÃ  chuá»—i flag náº±m trong file `script.js`:
![function check](/src/2022/Flare-on9/01_Flaredle/01_function_check.png)
Ta tÃ¬m kiáº¿m `rightGuessString` xem nÃ³ lÃ  gÃ¬??
![var right](/src/2022/Flare-on9/01_Flaredle/02_var_rightguessstring.png)
Ok nháº­n tháº¥y biáº¿n nÃ y Ä‘Æ°á»£c láº¥y tá»« thá»© `57` trong file `words.js`. Tá»« Ä‘Ã³ ta nháº­n Ä‘Æ°á»£c: `flareonisallaboutcats`. Kiá»ƒm tra láº¡i trÃªn web thá»a mÃ£n.
![check result](/src/2022/Flare-on9/01_Flaredle/03_check_result.png)

### 2: PixelPocker (Solved)

Description

```text
I said you wouldn't win that last one. I lied. The last challenge was basically a captcha. Now the real work begins. Shall we play another game?
```

CÃ´ng cá»¥ Ä‘Æ°á»£c sá»­ dá»¥ng:

- CFF Explorer
- IDA Pro
- Python
  - PIL: pip install pillow (1 fork tá»« thÆ° viá»‡n PIL cá»§a python Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ xá»­ lÃ½ hÃ¬nh áº£nh)

Ná»™i dung cá»§a `readme.txt`

```text
Welcome to PixelPoker ^_^, the pixel game that's sweeping the nation!

Your goal is simple: find the correct pixel and click it

Good luck!
```

Äáº§u tiÃªn ta má»Ÿ báº±ng `CFF Explorer` quan sÃ¡t metadata cá»§a file exe. VÃ  ta cÃ³ chÃº Ã½ vá» resourse lÃ  dáº¡ng Bitmaps (áº£nh) gá»“m 2 bá»©c áº£nh vá»›i tÃªn 129 vÃ  133.
![check metadata](/src/2022/Flare-on9/02_PixelPocker/00_check_cff.png)
ChÆ°Æ¡ng trÃ¬nh hÆ°á»›ng Ä‘áº¿n viá»‡c cáº§n pháº£i lÆ°áº¡ chá»n 1 Ä‘iá»ƒm áº£nh vá»›i tá»a Ä‘á»™ hiá»‡n thá»‹ trÃªn cá»­a sá»• vÃ  cÃ³ Ä‘á»‘i ta 10 láº§n thá»­.
![open file](/src/2022/Flare-on9/02_PixelPocker/00_open_file.png)

vÃ  tÃ´i thá»­ xem ra káº¿t quáº£ lÃ  gÃ¬:
![test](/src/2022/Flare-on9/02_PixelPocker/01_result_test_1.png)
Ta nháº­n Ä‘Æ°á»£c thÃ´ng bÃ¡o `Womp womp...:(`. Rá»“i chÃºng ta sáº½ má»Ÿ chÃºng báº±ng IDA Pro kiáº¿m strings nÃ y náº±m á»Ÿ hÃ m nÃ o?.
![open ida](/src/2022/Flare-on9/02_PixelPocker/02_open_ida.png)
Ta sá»­a Ä‘á»•i láº¡i tÃªn cá»§a má»™t sá»‘ biáº¿n nháº­n diá»‡n rá»“i.
NhÆ° Ä‘Ã£ tháº¥y thÃ¬ ta tháº¥y cÃ³ hÃ m kiá»ƒm tra 2 vá»‹ trÃ­ `x,y` vá»›i má»™t giÃ¡ trá»‹ cÃ³ sáºµn láº¥y dÆ° vá»›i `uX` vÃ  `uY`.
![see var ux](/src/2022/Flare-on9/02_PixelPocker/03_see_var_ux.png)
Ta cáº§n tÃ¬m hiá»ƒu xem biáº¿n `dword_413280` lÃ  gÃ¬? thÃ¬ nÃ³ náº±m trong hÃ m `BitBlt` - 1 hÃ m thá»±c hiá»‡n truyá»n khá»‘i bit dá»¯ liá»‡u tÆ°Æ¡ng á»©ng vá»›i má»™t hÃ¬nh chá»¯ nháº­t pixel tá»« ngá»¯ cáº£nh thiáº¿t bá»‹ nguá»“n Ä‘Ã£ chá»‰ Ä‘á»‹nh sang ngá»¯ cáº£nh thiáº¿t bá»‹ Ä‘Ã­ch.

```C++
BOOL BitBlt(
    [in] HDC   hdc,
    [in] int   x,
    [in] int   y,
    [in] int   cx,
    [in] int   cy,
    [in] HDC   hdcSrc,
    [in] int   x1,
    [in] int   y1,
    [in] DWORD rop
);
```

Do Ä‘Ã³ `dword_413280` lÃ  `cx` - lÃ  chiá»u rá»™ng cá»§a nguá»“n (á»Ÿ trÆ°á»ng há»£p nÃ y lÃ  hÃ¬nh áº£nh); cÃ²n `cy` - lÃ  chiá»u cao cá»§a hÃ¬nh áº£nh.

```text
[in] cx
The width, in logical units, of the source and destination rectangles.

[in] cy
The height, in logical units, of the source and the destination rectangles.
```

![so sanh](/src/2022/Flare-on9/02_PixelPocker/04_so_sanh.png)
BÆ°á»›c so sÃ¡nh á»Ÿ dÃ²ng 43 vÃ  46 kiá»ƒm tra giÃ¡ trá»‹ cá»§a tá»a Ä‘á»™ click chuá»™t theo trá»¥c `(x,y)` thá»a mÃ£n Ä‘iá»u kiá»‡n sau:

x = 0x52414c46 % Ä‘á»™ rá»™ng áº£nh = 0x52414c46 % 741 = 95

y = 0x6e4f2d45 % Ä‘á»™ cao áº£nh = 0x6e4f2d45 % 641 = 313

NhÆ° váº­y ta click Ä‘Ãºng tá»a Ä‘á»™ trÃªn thÃ¬ sáº½ chuyá»ƒn sang luá»“ng khÃ¡c vÃ  cÃ³ káº¿t quáº£:
![result](/src/2022/Flare-on9/02_PixelPocker/05_result.png)

### 3: Magic_8_Ball (Solved)

Description:

```text
You got a question? Ask the 8 ball!
```

Äáº§u tiÃªn ta giáº£i nÃ©n thÃ¬ ta nháº­n Ä‘Æ°á»£c nhiá»u file khÃ´ng biáº¿t file nÃ o sáº½ lÃ  quan trá»ng nÃªn chÃºng ta trÆ°á»›c máº¯t ta cá»© quan tÃ¢m chÃ­nh vÃ o file chÆ°Æ¡ng trÃ¬nh `.exe` nha.
![giai nen](/src/2022/Flare-on9/03_Magic_8_Ball/00_giai_nen.png)
Má»Ÿ file thá»±c thi nÃªn tháº¥y nháº­p 1 gÃ¬ Ä‘Ã³ rá»“i Enter thÃ¬ ta nháº­p Ä‘Æ°á»£c cÃ¡c thÃ´ng Ä‘iá»‡p vÃ  nháº¥n cÃ¡c mÅ©i tÃªn thÃ¬ ta tháº¥y quáº£ bÃ³ng láº¯c:
![open](/src/2022/Flare-on9/03_Magic_8_Ball/01_open.png)
Ta má»Ÿ nÃ³ báº±ng `IDA Pro` xem sao nhÃ¡. ThÃ¬ tháº¥y Ä‘Æ°á»£c cÃ¡c string hiá»‡n thá»‹ lÃºc nÃ£y Ä‘á»u náº±m cÃ¹ng 1 hÃ m `sub_4012B0`:
![string](/src/2022/Flare-on9/03_Magic_8_Ball/02_string.png)
Tiáº¿p tá»¥c theo dáº¥u xem hÃ m nÃ o sáº½ call Ä‘áº¿n hÃ m nÃ y (chÃºng ta sáº½ rename lÃ  `predict_string_func`) thÃ¬ tháº¥y nÃ³ Ä‘Æ°á»£c gá»i tá»« `sub_4027A0`, cÃ³ láº½ Ä‘Ã¢y lÃ  hÃ m main cá»§a chÆ°Æ¡ng trÃ¬nh. Äá»ƒ Ã½ phÃ­a dÆ°á»›i cÃ³ má»™t vÃ²ng láº·p do while, ráº¥t giá»‘ng vá»›i vÃ²ng láº·p xá»­ lÃ½ cÃ¡c sá»± kiá»‡n (event) ráº¥t hay gáº·p trong cÃ¡c á»©ng dá»¥ng GUI.
![main](/src/2022/Flare-on9/03_Magic_8_Ball/03_func_main.png)
Äi dáº¡o quanh cÃ¡c hÃ m trong vÃ²ng láº·p do while thÃ¬ ta nháº­n ra Ä‘oáº¡n nÃ y giá»‘ng nhÆ° Ä‘oáº¡n Ä‘iá»u hÆ°á»›ng cá»§a quáº£ bÃ³ng:
![04](/src/2022/Flare-on9/03_Magic_8_Ball/04.png)
vÃ  kÃ©o xuá»‘ng dÆ°á»›i thÃ¬ lÃ  cÃ¡c cÃ¢u lá»‡nh Ä‘iá»u kiá»‡n kiá»ƒm tra lá»“ng nhau. TrÆ°á»ng há»£p nÃ y ta convert cÃ¡c sá»‘ `76,85,82,68` sang kiá»ƒu dá»¯ liá»‡u `char`:
![command if](/src/2022/Flare-on9/03_Magic_8_Ball/05_command_if.png)

Ta nháº­n Ä‘Æ°á»£c: `LLURULDUL`. Sau khi kiá»ƒm tra chuá»—i nÃ y xong thÃ¬ sáº½ so sÃ¡nh chuá»—i cÃ³ Ä‘á»™ dÃ i 15 kÃ½ tá»±:

```c
result = strncmp(v21, (const char *)(this + 92), 15u);
```

Ta debug táº¡i IDA luÃ´n Ä‘iá»u hÆ°á»›ng quáº£ bÃ³ng nhÆ° trÃªn mÃ¬nh phÃ¢n tÃ­ch rá»“i ta nháº­p 1 string nÃ o Ä‘Ã³ rá»“i Ä‘áº·t `breakpoint` (F2) táº¡i hÃ m so sÃ¡nh nÃ y thÃ¬ ta nháº­n Ä‘Æ°á»£c nhÆ° sau:
![debug check](/src/2022/Flare-on9/03_Magic_8_Ball/06_debug_check.png)
NhÆ° váº­y ta nháº­n tháº¥y cÃ³ 2 cÃ¢u lá»‡nh 3 cÃ¢u lá»‡nh `push` trÆ°á»›c khi gá»i hÃ m `strncmp` cÃ³ nghÄ©a lÃ  truyá»n tham sá»‘ vÃ o hÃ m Ä‘Ã³ tÆ°Æ¡ng á»©ng: `push` tá»« pháº£i qua trÃ¡i -> ta tháº¥y thanh ghi `ecx` sáº½ lÃ  string mÃ¬nh nháº­p vÃ  thanh ghi `eax` chÃ­nh lÃ  nguá»“n sáº½ so sÃ¡nh.
![eax](/src/2022/Flare-on9/03_Magic_8_Ball/07_check_eax.png)
vÃ  má»i thá»© coi nhÆ° Ä‘Ã£ xong kiáº¿m Ä‘Æ°á»£c string so sÃ¡nh lÃ : `gimme flag pls?`
Cháº¡y láº¡i chÆ°Æ¡ng trÃ¬nh, nháº­p Ä‘Ãºng chuá»—i phÃ­m Ä‘á»‹nh hÆ°á»›ng quáº£ bÃ³ng vÃ  nháº­p cÃ¢u há»i vá»«a tÃ¬m Ä‘Æ°á»£c sáº½ in ra flag:
![flag](/src/2022/Flare-on9/03_Magic_8_Ball/08_result.png)

```text
U_cRackeD_th1$_maG1cBaLL_!!_@flare-on.com
```

### 4: darn_mice

Description:

```text
"If it crashes its user error." - Flare Team
```

Äá» bÃ i cho 1 file `darn_mice.exe`. Äáº§u tiÃªn tÃ´i sáº½ kiá»ƒm tra cÃ¡c thÃ´ng tin cá»§a file báº±ng pháº§n má»m `Detect It Easy` (viáº¿t táº¯t cá»§a chÆ°Æ¡ng trÃ¬nh sáº½ lÃ  `die` mÃ u vÃ ng) chÃºng ta biáº¿t Ä‘Æ°á»£c Ä‘Ã¢y lÃ  1 á»©ng dá»¥ng console viáº¿t báº±ng C++.
![open check die](/src/2022/Flare-on9/04_darn_mice/00_open_check_die.png)
TÃ´i vÃ o console cháº¡y thá»­ khÃ´ng cho tham sá»‘ thÃ¬ khÃ´ng tháº¥y ra gÃ¬ vÃ  thÃªm tham sá»‘ thÃ¬ cÃ³ ra káº¿t quáº£ -> bÃ i yÃªu cáº§u truyá»n tham sá»‘ nhÆ° password náº¿u Ä‘Ãºng sáº½ in ra flag gÃ¬ Ä‘Ã³.
![open console](/src/2022/Flare-on9/04_darn_mice/01_open_console.png)
Äá»ƒ kiá»ƒm tra vÃ  lÃ m tÃ´i má»Ÿ IDA thÃ¬ ta tháº¥y
![open ida check main](/src/2022/Flare-on9/04_darn_mice/02_open_ida_check_main.png)
NhÆ° váº­y hÃ m nÃ y chÃ­nh xÃ¡c lÃ  yÃªu cáº§u ta truyá»n vÃ o lÃ  2 `argc`.
Náº¿u Ä‘á»§ sáº½ vÃ o chÆ°Æ¡ng trÃ¬nh kiá»ƒm tra `password`:
![func check pass](/src/2022/Flare-on9/04_darn_mice/03_func_check_pass.png)
á» Ä‘Ã¢y ta phÃ¢n tÃ­ch nhÆ° sau: (sá»­a tÃªn láº¡i ta cÃ³ nhÆ° sau)
![rename](/src/2022/Flare-on9/04_darn_mice/04_rename.png)

- Chuá»—i ta nháº­p thÃ¬ sáº½ gá»i lÃ  `pbPassword`.
- Sau Ä‘Ã³ sáº½ in ra mÃ n hÃ¬nh -> tiáº¿p Ä‘áº¿n lÃ  kiá»ƒm tra kÃ­ch thÆ°á»›c cá»§a `pbPassword`: `if (!v3 || v3 > 0x23)` pháº§n nÃ y check strlen pháº£i thá»a mÃ£n tá»“n táº¡i vÃ  khÃ´ng Ä‘Æ°á»£c lá»›n hÆ¡n `0x23` nÃ³ lÃ  35 -> kÃ­ch thÆ°á»›c cá»§a `pbPassword` lÃ  `35`:

Tiáº¿p Ä‘áº¿n ta Ä‘á»ƒ Ã½ Ä‘áº¿n vÃ²ng láº·p for:

- Äáº§u tiÃªn, thá»±c hiá»‡n allocation má»™t vÃ¹ng nhá»›, kÃ­ch thÆ°á»›c 0x1000 lÆ°u vÃ o `v2`
- Sau Ä‘Ã³ lÃ  láº¥y tá»«ng kÃ½ tá»± cá»§a `pbPassword` Ä‘em cá»™ng tÆ°Æ¡ng á»©ng vá»›i vá»‹ trÃ­ cá»§a biáº¿n `magic` Ä‘Ã£ Ä‘Æ°á»£c khai bÃ¡o vÃ  gÃ¡n giÃ¡ trá»‹ á»Ÿ Ä‘áº§u func.
- GÃ¡n giÃ¡ trá»‹ nÃ y cho byte Ä‘áº§u tiÃªn cá»§a vÃ¹ng nhá»› vá»«a Ä‘Æ°á»£c khá»Ÿi táº¡o
- Nháº£y Ä‘áº¿n vÃ o cháº¡y code táº¡i vÃ¹ng nhá»› Ä‘Ã³ (tÆ°Æ¡ng á»©ng vá»›i lá»‡nh gá»i `v2(v2)`)
- in ra chuá»—i `Nibble...`
- Tiáº¿p tá»¥c vÃ²ng láº·p

Qua Ä‘oáº¡n for nÃ y náº¿u nháº­p Ä‘Ãºng, chÆ°Æ¡ng trÃ¬nh sáº½ dÃ¹ng password nÃ y Ä‘á»ƒ decrypt ra flag


<!-- http://diendan.congdongcviet.com/threads/t35646::calling-syntax-calling-convertion.cpp -->
### 5: t8

### 6: alamode

### 7: anode

### 8: backdoor

### 9: encryptor

### 10: Nur_getraÌˆumt

### 11: the_challenge_that_shall_not_be_named

<!-- 
https://sec.vnpt.vn/2022/11/flare-on-9-writeup-part2-chal8-11/
https://sec.vnpt.vn/2022/11/flare-on-9-writeup-part1-chal1-7/
 -->