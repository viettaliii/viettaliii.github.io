---
title: DefCamp 2022
author: vietzettt
date:  2022-09-30 
layout: post
cover: /src/2022/DefCampCTF/00_cover.png  
---

---

##### **Ngu·ªìn ·ªü ƒë√¢y nh√° c√°c b·∫°n:** [üíÄ**üëÜüëÜüëÜ**üíÄ](https://github.com/vietzettt/vietzettt.github.io/tree/main/src/2022/DefCampCTF)

Ch√†o m·ª´ng b·∫°n ƒë√£ quay tr·ªü l·∫°i v·ªõi 1 v√†i b√†i RE th√∫ v·ªã v√† kh√° ƒë∆°n gi·∫£n c·ªßa gi·∫£i m√† ph·∫£i n√≥i l√† t√¥i tham gia ng·∫´u h·ª©ng thui üòÅ. Kh√¥ng d√†i d√≤ng n·ªØa v√†o vi·ªác th√¥i.

### 1: cryogenics (Solved)

![ti√™u ƒë·ªÅ nhi·ªám v·ª•](/src/2022/DefCampCTF/cryogenics/img/00_title.png)

C√°i ƒë·ªÅ b√†i c≈©ng kh√¥ng c√≥ g√¨ (nh∆∞ng l√∫c trong qu√° tr√¨nh gi·∫£i khi·∫øn t√¥i ph·∫£i t·ªën th·ªùi gian v·ªÅ n√≥ qu√°)

B·∫Øt ƒë·∫ßu v·ªõi vi·ªác t·∫£i file (Link ngu·ªìn t√¥i c√≥ ƒë·ªÉ tr√™n ƒë·∫ßu b√†i r·ªìi nh√°) v√† ki·ªÉm tra xem th√¥ng tin file nh·ªâ: Nay t√¥i s√†i ph·∫ßn m·ªÅm `HxD` - ph·∫ßn m·ªÅm ch·ªânh s·ª≠a hex:

![open](/src/2022/DefCampCTF/cryogenics/img/01_open_check_file.png)

ƒê√≥ nh∆∞ ta quan s√°t th·∫•y c√≥ d√≤ng `.ELF` - **Executable and Linkable Format** - ƒë·ªãnh d·∫°ng ph·ªï bi·∫øn d√†nh cho c√°c m√£ th·ª±c thi, code ƒë·ªëi t∆∞·ª£ng, th∆∞ vi·ªán ƒë∆∞·ª£c chia s·∫ª v√† k·∫øt xu·∫•t l√µi, ƒë∆∞·ª£c xu·∫•t b·∫£n cho giao di·ªán nh·ªã ph√¢n ·ª©ng d·ª•ng (ABI) c·ªßa phi√™n b·∫£n h·ªá ƒëi·ªÅu h√†nh *Unix*. ƒê·∫°i l·∫°i n√≥ ph√π h·ª£p ƒë·ªÉ ch·∫°y tr√™n *Ubuntu, linux,...(n√≥ ƒë∆∞·ª£c ph√°t tri·ªÉn t·ª´ c√°c OS Unix*.

> Ch√∫ th√≠ch: `0x7F` theo sau `ELF` (`45 4C 46`) v√† bytes ti·∫øp theo s·ªë 5 n·∫øu l√† `01` th√¨ 32 bit or `02` th√¨ 64 bit nh√°.

T√¥i m·ªü m√°y ·∫£o `linux` v√† ch·∫°y th·ª≠:

![run](/src/2022/DefCampCTF/cryogenics/img/02_run_file_linux.png)

Th·ª≠ th√°ch y√™u c·∫ßu ƒë·∫ßu v√†o l√† `Password` v√† output cho ta flagüíÄ. T√¥i s·∫Ω ch·∫°y *IDA* ƒë·ªÉ ph√¢n t√≠ch

![open ida](/src/2022/DefCampCTF/cryogenics/img/03_ida_open.png)

B·∫Øt ƒë·∫ßu ƒë·ªçc code n√†oü´°: (T√¥i th·∫•y b√†i code b·ªã d·ªëi v√† c√≥ th·ªÉ ƒë√£ c√≥ t√°c ƒë·ªông khi·∫øn *IDA* kh√¥ng hi·ªán thi ƒë√∫ng logic c·ªßa ch∆∞∆°ng tr√¨nh, b·ªüi ƒë√≥ m√¨nh th∆∞·ªùng s·∫Ω ƒëi ki·∫øm `strings`c·ªßa ch∆∞∆°ng tr√¨nh):

![find strings](/src/2022/DefCampCTF/cryogenics/img/04_strings_open.png)

ƒê√≥ ta nh·∫≠n th·∫•y c√≥ ƒëo·∫°n strings (shortcut key: **Shift + F12**) output m√† ta ƒë√£ b·∫Øt g·∫∑p khi ch·∫°y. `Too cold outside` -> c·ª© ti·∫øp t·ª•c theo ƒë√≥ n√†o. Nh·∫•n ƒë√∫p chu·ªôt:

![show add](/src/2022/DefCampCTF/cryogenics/img/05_show_address_string.png)

nh·∫•n **X** ƒë·ªÉ hi·ªán th·ªã xem c√¢u l·ªánh n√†o g·ªçi hay s·ª≠ d·ª•ng ƒë·∫øn strings ƒë√≥

![show control](/src/2022/DefCampCTF/cryogenics/img/06_show_control_for_string.png)

v√† nh·∫≠n v√† ta th·∫•y c√≥ c√¢u l·ªánh `test eax, eax` ki·ªÉm tra ƒë·ªÉ chuy·ªÉn h∆∞·ªõng ch∆∞∆°ng tr√¨nh:

![07](/src/2022/DefCampCTF/cryogenics/img/07_function_show_into.png)

tr∆∞·ªõc c√¢u l·ªánh `test` c√≥ c√¢u l·ªánh `call` ƒë·∫øn function ƒë·ªÉ ki·ªÉm tra g√¨ ƒë√≥ r·ªìi tr·∫£ v·ªÅ gi√° tr·ªã `eax` ƒëem so s√°nh, v√† ·ªü d∆∞·ªõi ƒë√≥ c√≥ l·ªánh `jnz` jump if not zeoro - nh·∫£y n·∫øu kh√¥ng b·∫±ng hay l√† output `Too...` v√† k·∫øt th√∫c ch∆∞∆°ng tr√¨nh kh√¥ng th·ªèa m√£n ƒëi·ªÅu ki·ªán.

ƒêi v√†o `strcmp` v√† s·ª≠ d·ª•ng **`F5`** huy·ªÅn tho·∫°i nh√©))

```c
// positive sp value has been detected, the output may be wrong!
__int64 __fastcall strcmp(__int64 a1)
{
  __int64 v1; // rax
  __int64 i; // rax
  char v4[15]; // [rsp+2h] [rbp-26h] BYREF
  char v5[23]; // [rsp+11h] [rbp-17h] BYREF

  qmemcpy(v4, "000000000000000", sizeof(v4)); // ƒë·∫°i kh√°i nh∆∞ t√¥i hi·ªÉu l√† n·∫øu input cho mk m√† b√© h∆°n k√≠ch th∆∞·ªõc c·ªßa bi·∫øn v4 s·∫Ω ch√®n 0000000 v√†o sau input
  v1 = 0LL;
  qmemcpy(v5, &unk_400328, 0xFuLL); // kh·∫£ nƒÉng l·∫•y d·ªØ li·ªáu ƒë√£ l∆∞u
  do
  {
    v4[v1] = __ROL1__(*(_BYTE *)(a1 + v1), 3); // __ROL1__: circular rotation to the lelf (xoay v√≤ng tr√≤n sang tr√°i) (unit8)
    ++v1;
  }
  while ( v1 != 15 );
  for ( i = 0LL; i != 15; ++i )
    v4[i] = __ROR1__(v4[i], 2); // __ROR1__: circular rotation to the right (xoay v√≤ng tr√≤n sang ph·∫£i) (unit8)
  return ((__int64 (__fastcall *)(char *, char *, __int64))strncmp)(v4, v5, 15LL); //g·ªçi h√†m ti·∫øp
}
```

Ki·ªÉm tra bi·∫øn `&unk_400328` kh√¥ng x√°c ƒë·ªãnh c√≥ ƒë·ªãa ch·ªâ:

![show var unk](/src/2022/DefCampCTF/cryogenics/img/08_show_var_unk.png)

ƒë√≥ l√† 1 m·∫£ng ta ƒë·ªãnh d·∫°ng 1 ch√∫t n√≥ s·∫Ω tr√¥ng nh∆∞ n√†y:

![09](/src/2022/DefCampCTF/cryogenics/img/09.png)

Nh∆∞ ƒë·ªãnh d·∫°ng c√≥ n√≥ theo d·∫°ng byte (v√¨ ƒëang l√† *unit8*), t·∫°o m·∫£ng v·ªõi ph√≠m t·∫Øt *A* v√† k·∫øt qu·∫£ nh·∫≠n ƒë∆∞·ª£c nh∆∞ h√¨nh tr√™n v·ªõi m·∫£ng g·ªìm 15 ph·∫ßn t·ª≠.

`__ROR1__ v√† __ROL1__` ƒë·∫°i l·∫°i l√† nh√¢n v√† chia v·ªõi 2 c√°c c∆° s·ªë l·∫ßn. T√¥i tham kh·∫£o ƒë∆∞·ª£c code python c·ªßa n√≥ ·ªü 1 trang web n√†y: [Link ƒë√¢y nh√©](https://onsoim.tistory.com/category/0x00%20Reversing/0x0F%20Utils)

![show blog](/src/2022/DefCampCTF/cryogenics/img/10_blog_ror_rol.png)

v√† th·ª© ch√∫ng ta c·∫ßn n√® code python:

```python
def __ROL__(num, count, bits=8):
    return ((num << count) | (num >> (bits - count))) & ((0b1<<bits) - 1)

def __ROR__(num, count, bits=8):
    return ((num >> count) | (num << (bits - count))) & ((0b1<<bits) - 1)
```

Ti·∫øp ƒë·∫øn ta ƒëi v√†o h√†m `strncmp` xem th·∫ø n√†o: (v·ªõi 3 tham s·ªë ƒë·∫ßu v√†o: `v4` l√† input c·ªßa m√¨nh ƒë√£ ƒë∆∞·ª£c `ROR v√† ROL`, `v5` l√† m·∫£ng ƒë∆∞·ª£c l·∫•y t·ª´ ngu·ªìn l∆∞u tr·ªØ, `15LL` l√† k√≠ch th∆∞·ªõc c·ªßa input v√† c≈©ng l√† k√≠ch th∆∞·ªõc c·ªßa m·∫£ng)

```c

// positive sp value has been detected, the output may be wrong!
__int64 __fastcall strncmp(__int64 a1, __int64 a2, __int64 a3)
{
  __int64 v3; // r8
  unsigned __int8 *v4; // r9
  unsigned __int8 v5; // al
  char v6; // cl

  v3 = 0LL;
  do
  {
    v4 = (unsigned __int8 *)(a2 + v3);
    if ( a3 == v3 )  // so s√°nh v·ªõi k√≠ch th∆∞·ªõc
      return 0LL; // k·∫øt qu·∫£ return mong mu·ªën m√† ta mu·ªën ƒë√¢y r·ªìi
    v5 = *(_BYTE *)(a1 + v3);   //l·∫•y gi√° tr·ªã ph·∫ßn t·ª≠ th·ª© v3 (input) trong m·∫£ng
    if ( !v5 ) //if not t·ªìn t·∫°i gi√° tr·ªã v5 d·ª´ng v√≤ng l·∫∑p do while
      break;
    v6 = *(_BYTE *)(a2 + v3++); // l·∫•y value ph·∫ßn t·ª≠ th·ª© v3 c·ªßa a2 (ngu·ªìn) trong m·∫£ng r·ªìi tƒÉng gi√° tr·ªã c·ªßa v3 l√™n 1
  }
  while ( (char)v5 == (v6 ^ 0xC) + 6 ); //ki·ªÉm tra v5 v·ªõi v6 xor v·ªõi 0xC + 6
  return v5 - (unsigned int)*v4; 
}
```

Th·∫ø l√† √Ω t∆∞·ªüng c·ªßa b√†i ƒë√£ ƒë∆∞·ª£c h√© l·ªô r·ªìi, gi·ªù t√¥i s·∫Ω s·ª≠ d·ª•ng python ƒë·ªÉ vi·∫øt ra ƒëo·∫°n m√£ c·∫ßn -> flagüè¥
D∆∞·ªõi l√† code python solve c·ªßa t√¥i nh√©:

```python
def __ROL__(num, count, bits=8):
    return ((num << count) | (num >> (bits - count))) & ((0b1<<bits) - 1)

def __ROR__(num, count, bits=8):
    return ((num >> count) | (num << (bits - count))) & ((0b1<<bits) - 1)

lst = [166, 166, 108, 226, 226, 222, 132, 188, 124, 236, 226, 120, 152, 166, 166]

for i in lst:
    for x in range(256):
        if  (i ^ 12) + 6 == __ROR__(__ROL__(x,3),2):
            print(chr(x), end="")
```

K·∫øt qu·∫£ nh·∫≠n ƒë∆∞·ª£c ƒë√∫ng theo y√™u c·∫ßu ƒë·ªÅ b√†i l√† ƒë∆∞·ª£c ƒë√≥ng bƒÉng, k·∫øt th√∫c b·∫±ng XX: `XX3zzlG[;sz=MXX`
v√† m√£ h√≥a `sha256`l√† xong -> K·∫øt qu·∫£ nh·∫≠n ƒë∆∞·ª£c `CTF{a41f954f18646f115d653d28213175a6d9ef0d383c80c99ac0ee060c217b99c6}` -> Done 1 b√†i th√∫ v·ªã.

L√∫c ƒë·∫ßu t√¥i ch∆°i nh√¨n qua th√¨ h·ªç ƒë√°nh l·ª´a t√¥i t·ªõi 2 l·∫ßn (l·∫ßn 1 l√† ƒëo·∫°n strings c√¥ng khai ki·∫øn t√¥i t∆∞·ªüng l√† so s√°nh v·ªõi n√≥ v√† --> game easy, but not; l·∫ßn 2 l√† h√†m `strncmp` l√†m t√¥i l·∫ßn t∆∞·ªüng ch·ªâ so s√°nh v√† tr·∫£ v·ªÅ 0 ho·∫∑c √¢m d∆∞∆°ng kh√¥ng th√¥i ai d√® c√≥ c≈©ng c√≤n `xor and add six`ü•∂ m·ªõi ra).

### 2: new-buldozer (Solved)

![title](/src/2022/DefCampCTF/new-buldozer/img/00_title.png)

ƒê·∫øn v·ªõi th·ª≠ th√°ch n√†y ta ƒë∆∞·ª£c l√†m quen v·ªõi ch∆∞∆°ng tr√¨nh tr√™n ƒëi·ªán tho·∫°i di ƒë·ªông, c·ª• th·ªÉ l√† `Android`.

T√¥i s·ª≠ d·ª•ng tool `apktool` ƒë·ªÉ gi·∫£i m√£ v√† ƒë·ªçc n√≥ xem sao nh√°:

![run apktool](/src/2022/DefCampCTF/new-buldozer/img/01_apk_tool_run.png)

N√≥ s·∫Ω tr·∫£ v·ªÅ cho ch√∫ng ta 1 th∆∞ m·ª•c m√† c√¥ng c·ª• c√≥ th·ªÉ gi·∫£i m√£ ƒë∆∞·ª£c. Ti·∫øp ƒë·∫øn t√¥i m·ªü ra v√† ki·∫øm ki·ªÉm tra c√°c file v√† m·ªü ch√∫ng b·∫±ng tool `jadx-gui` (Th∆∞·ªùng l√† c√°c file c√≥ ƒëu√¥i `.smail`):

![open jadx](/src/2022/DefCampCTF/new-buldozer/img/02_open_jadx.png)

T√¥i ki·ªÉm tra qua h·∫øt t·∫•t c·∫£ th√¨ kh√¥ng th·∫•y c√≥ g√¨ ƒë√≥ c·∫£ to√†n c√°c h√†m c·ªßa ch∆∞∆°ng tr√¨nh th·ª±c thi b·∫±ng `java`. Ti·∫øp ƒë·∫øn t√¥i th·∫•y nghi ng·ªù file `private.taz` ƒë∆∞·ª£c n√©n v√†o m√† t√¥i ch∆∞a ƒë·ªçc:

![ex](/src/2022/DefCampCTF/new-buldozer/img/03_ex_file_pri.png)

·ªí c√≥ h·∫≥n 3 file trong ƒë√≥ v√† gi·ªù t√¥i v√†o ƒë·ªçc n√≥, format file `.pyc` - l√† file th√¥ng d·ªãch Python khi n√≥ chuy·ªÉn ƒë·ªïi code th√†nh m√£ bytecode ƒë∆∞·ª£c bi√™n d·ªãch.

T√¥i th·ª≠ ki·∫øm strings trong file tr∆∞·ªõc xem sao:

```shell
strings main.pyc 
 X3c
m       Z
1.0.9)
Builder)
GridLayout)
NumericProperty)
Appz
<HelloWorldScreen>:
    cols: 1
    Label:
        text: 'Welcome to the Hello world'
    Button:
        text: 'Click me! %d' % root.counter
        on_release: root.my_callback()
HelloWorldScreenr
The button has been pushed
V1ROU2JXVjZaRzFPVkZKc1RWUldhVmt5V1hsYVZFNXFUVmRaTVU1NlVUVlplbWhvVG5wU2JVMVVRVEJOYW1jeFdXcGplRnBYV1RKWk1sVjZUVlJCZUZsNmJHMU9SMVY2VFZkU2ExbHRVbXhOVkZVMFRsUlZlazlFU2prPQ==)
print
counter
self
H/home/lucian/Desktop/ctf/new-buldozer/dev/.buildozer/android/app/main.py
my_callback
HelloWorldScreen.my_callbackN)
__name__
__module__
__qualname__r
HelloWorldAppc
build
HelloWorldApp.buildN)
__main__)
kivyZ
requireZ        kivy.langr
kivy.uix.gridlayoutr
kivy.propertiesr
kivy.appr
load_stringr
runr
<module>
```

·ªí c√≥ 1 ƒëo·∫°n m√£ `base64` k√¨a decode xem sao nh√° v√† k·∫øt qu·∫£ khi n√©m n√≥ l√™n `CyberChef`th√¨ th·∫≠t b·∫•t ng·ªù:

![decode](/src/2022/DefCampCTF/new-buldozer/img/04_decode_base64.png)

Th·∫≠t l√† Magic lu√¥n khi t√¥i ch·ªâ gi·∫£i m√£ base64 1 l·∫ßn c√≤n l·∫°i do web g·ª£i √≠ v√† ƒë√∫ng nh∆∞ √Ω mu·ªën.üòú

V√† t·∫•t nhi√™n r·ªìi flag: `ctf{7f54e15bcf2e3c1f5749c8a74f104285b71ef6ce3101c9f4e31ddbde15855382}`.

### 3: xrypto (Unsolved)

`__int8, __int16, __int32, __int64` - T∆∞∆°ng ·ª©ng v·ªõi bi·∫øn khai bi·∫øn c√≥ k√≠ch th∆∞·ªõc 8, 16, 32, 64 bit.

`__readfsbyte, __readfsdword, __readfsqword, __readfsword` ƒë·ªçc b·ªô nh·ªõ t·ª´ m·ªôt v·ªã tr√≠ ƒë∆∞·ª£c ch·ªâ ƒë·ªãnh b·ªüi m·ªôt ph·∫ßn b√π so v·ªõi ƒë·∫ßu c·ªßa offset FS:[Offsett]
