---
title: "Writeup DownUnderCTF 2022"
author: vietzettt
date: 2022-09-23
layout: post
cover: /src/2022/DownUnderCTF/00_img_pages/cover.webp
---

---

##### **Ngu·ªìn ·ªü ƒë√¢y nh√° c√°c b·∫°n:** [üíÄ**Nh·∫•p em ƒëi**üëÜ](https://github.com/vietzettt/vietzettt.github.io/tree/main/src/2022/DownUnderCTF)

M·ªôt gi·∫£i CTF l·∫ßn ƒë·∫ßu tham gia c·ªßa t√¥i v√† team t√¥i v·ªõi nh·ªØng ki·∫øn th·ª©c t·ª± h·ªçc sau 1 th·ªùi gian. V·ªõi nhi·ªÅu challenges c·ªßa nhi·ªÅu m·∫£ng, nh∆∞ng t√¥i s·∫Ω vi·∫øt b√†i d∆∞·ªõi ƒë√¢y l√† m·∫£ng c·ªßa t√¥i y√™u th√≠ch v√† s·∫Ω ƒëi theo ƒë√≥ l√† RE, m·ªôt m·∫£ng r·∫•t c·∫ßn c∆° b·∫£n nh∆∞ ng√¥n ng·ªØ assembly x86/x64 nh√°üòÅ

Sau ƒë√¢y t√¥i v√†o vi·ªác ƒë√¢y, nay th·ªùi ti·∫øt ·ªü Nga nh∆∞ bao ng√†y √≠ √¨ y l·∫°nh)))ü•∂ √† m√† c√≥ l√≤ s∆∞·ªüi th·∫ø l√† n√≥ng l·∫Øm mn>> m√† th√¥i g√©t g√¥ü§™

### 1: source provided (Solved)

![·∫¢nh m√¥ t·∫£ nhi·ªám v·ª• 1](/src/2022/DownUnderCTF/source-provided/img/00_title.png)

Th·ª≠ th√°ch ƒë·∫ßu ti√™n l√† beginner th·∫ø n√™n t√¥i tin l√† n√≥ s·∫Ω kh√¥ng qu√° kh√≥ nh·ªâ

T√¥i t·∫£i c√°c file v·ªÅ v√† m·ªü file `chall.S`:

```code
SECTION .data
c db 0xc4, 0xda, 0xc5, 0xdb, 0xce, 0x80, 0xf8, 0x3e, 0x82, 0xe8, 0xf7, 0x82, 0xef, 0xc0, 0xf3, 0x86, 0x89, 0xf0, 0xc7, 0xf9, 0xf7, 0x92, 0xca, 0x8c, 0xfb, 0xfc, 0xff, 0x89, 0xff, 0x93, 0xd1, 0xd7, 0x84, 0x80, 0x87, 0x9a, 0x9b, 0xd8, 0x97, 0x89, 0x94, 0xa6, 0x89, 0x9d, 0xdd, 0x94, 0x9a, 0xa7, 0xf3, 0xb2

SECTION .text

global main

main:
    xor rax, rax
    xor rdi, rdi
    mov rdx, 0x32
    sub rsp, 0x32
    mov rsp, rsi
    syscall

    mov r10, 0
l:
    movzx r11, byte [rsp + r10]
    movzx r12, byte [c + r10]
    add r11, r10
    add r11, 0x42
    xor r11, 0x42
    and r11, 0xff
    cmp r11, r12
    jne b

    add r10, 1
    cmp r10, 0x32
    jne l

    mov rax, 0x3c
    mov rdi, 0
    syscall

b:
    mov rax, 0x3c
    mov rdi, 1
    syscall

```

ƒê√¢y l√† file ƒë∆∞·ª£c vi·∫øt d∆∞·ªõi d·∫°ng **asm x86**, do ƒë√≥ ta ƒëi v√†o ƒë·ªçc xem th·∫ø n√†o nh√©

```code
SECTION .data ; ƒë√¢y l√† m·∫£ng c√°c s·ªë c√≥ th·ªÉ ƒë·ªÉ s·ª≠ d·ª•ng n√≥ ƒë·ªÉ t·∫°o th√†nh flag
c db 0xc4, 0xda, 0xc5, 0xdb, 0xce, 0x80, 0xf8, 0x3e, 0x82, 0xe8, 0xf7, 0x82, 0xef, 0xc0, 0xf3, 0x86, 0x89, 0xf0, 0xc7, 0xf9, 0xf7, 0x92, 0xca, 0x8c, 0xfb, 0xfc, 0xff, 0x89, 0xff, 0x93, 0xd1, 0xd7, 0x84, 0x80, 0x87, 0x9a, 0x9b, 0xd8, 0x97, 0x89, 0x94, 0xa6, 0x89, 0x9d, 0xdd, 0x94, 0x9a, 0xa7, 0xf3, 0xb2

SECTION .text

global main

main:                   ; ƒëi v√†o h√†m n√†o
    xor rax, rax        ; rax = 0
    xor rdi, rdi        ; rdx = 0
    mov rdx, 0x32       ; rdx = 0x32
    sub rsp, 0x32       ; rsp = rsp - 0x32
    mov rsp, rsi
    syscall

    mov r10, 0          ; r10 = 0
l:
    movzx r11, byte [rsp + r10]    ; c√≥ l·∫Ω c√°i n√†y n√≥ l√† input ƒë·∫ßu v√†o
    movzx r12, byte [c + r10]      ; c√≤n c√°i n√†y .data c 
    add r11, r10                   ; input = input + r10 (kh·∫£ nƒÉng add v·ªõi index c·ªßa n√≥)
    add r11, 0x42                  ; input = input + 0x42
    xor r11, 0x42                  ; input = input ^ 0x42
    and r11, 0xff                  ; input = input & 0xff
    cmp r11, r12                   ; so s√°nh input v·ªõi t·ª´ng gi√° tr·ªã trong .data
    jne b                          ; jump if not equal

    add r10, 1                     ; c√≥ th·ªÉ hi·ªÉu ind++
    cmp r10, 0x32                  ; so s√°nh n√≥ v·ªõi 0x32
    jne l                          ; jump if not equal 

    mov rax, 0x3c                  
    mov rdi, 0                      ; return 0 (th·ªèa m√£n)
    syscall

b:
    mov rax, 0x3c 
    mov rdi, 1                      ; c√≥ th·ªÉ hi·ªÉu l√† return 1 (l·ªói)
    syscall

```

T·ª´ ph√¢n t√≠ch tr√™n th√¨ ta th·∫•y r√µ b√†i n√†y s·∫Ω y√™u c·∫ßu ta nh·∫≠p `input` flag r·ªìi r·ªìi m√£ h√≥a t·ª´ng k√≠ t·ª± c·ªßa `input` ƒëem so s√°nh v·ªõi `c`
V·ªõi b√†i n√†y ch·ªâ s·ª≠ d·ª•ng to√°n t·ª≠ `xor, and, add` n√™n t√¥i s·∫Ω ƒë·∫£o ng∆∞·ª£c l·∫°i qu√° tr√¨nh n√≥ v·ªõi `c` l√† ƒë·∫ßu v√†o v√† `print` k·∫øt qu·∫£ nh·∫≠n ƒë∆∞·ª£c.
V√† ƒë√¢y l√† source Python t√¥i code ƒë·ªÉ t·∫°o flag:

```python
c = [0xc4, 0xda, 0xc5, 0xdb, 0xce, 0x80, 0xf8, 0x3e, 0x82, 0xe8, 0xf7, 0x82, 0xef, 0xc0, 0xf3, 0x86, 0x89, 0xf0, 0xc7, 0xf9, 0xf7, 0x92, 0xca, 0x8c, 0xfb, 0xfc, 0xff, 0x89, 0xff, 0x93, 0xd1, 0xd7, 0x84, 0x80, 0x87, 0x9a, 0x9b, 0xd8, 0x97, 0x89, 0x94, 0xa6, 0x89, 0x9d, 0xdd, 0x94, 0x9a, 0xa7, 0xf3, 0xb2]

flag = []
for i, x in enumerate(c):
    b = ((x ^ 0x42) - 0x42 - i) % 256
    flag.append(b)
print(bytes(flag).decode())
```

V√† ch·∫°y n√≥ ta nh·∫≠n ƒë∆∞·ª£c flag: `DUCTF{r3v_is_3asy_1f_y0u_can_r34d_ass3mbly_r1ght?}`
V√† ch√∫c m·ª´ng ta ƒë√£ ho√†n th√†nh xong task ƒë·∫ßu ti√™n nh√°.

### 2: Legit App Not Ransomware (Solved)

![·∫¢nh m√¥ t·∫£ nhi·ªám v·ª• 2](/src/2022/DownUnderCTF/legit-app-not-ransomware/img/00_title.png)

K·∫øt qu·∫£ t√¥i ch·∫°y th·ª≠ ch∆∞∆°ng tr√¨nh:

![run file](/src/2022/DownUnderCTF/legit-app-not-ransomware/img/01_run_file.png)

Ta nh·∫≠n ƒë∆∞·ª£c k·∫øt qu·∫£ l√† y√™u c·∫ßu ta ch·∫°y tr√™n n·ªÅn t·∫£ng `.NET`, do ƒë√≥ ta c√≥ th·ªÉ s·ª≠ d·ª•ng c√°c ph·∫ßm m·ªÅm nh∆∞ dotPeek, ilspy, dnSpy,...
T√¥i s·∫Ω ch·∫°y ch∆∞∆°ng tr√¨nh b·∫±ng dotPeek, t√¨m ki·∫øm strings v√† c√°c h√†m, ƒë·ªÉ xem h√†m `main` ·ªü ƒë√¢u v√† th·ª±c hi·ªán g√¨:

![2](/src/2022/DownUnderCTF/legit-app-not-ransomware/img/02.png)

D∆∞·ªõi ƒë√¢y l√† code c·ªßa to√†n ch∆∞∆°ng tr√¨nh khi dotPeek gi·∫£i cho ta:

```c#
using Microsoft.VisualBasic.CompilerServices;
using System;
using System.Collections.Generic;
using System.IO;
using System.Text;
using System.Threading;

namespace LegitAppNotRansomware
{
  [StandardModule]
  internal sealed class Program
  {
    private static string a = "d3Jvbmdv";
    private static string b = "aHR0cHM6Ly9iaXQubHkvM05SMkVvYg==";
    private static string c = "OXdZV";
    private static string d = "UkZWRFZF";
    private static string e = "J1mM7";
    private static string f = "elgyTjFZM1Z0WWpOeWZRPT0";
    private static string g = "4n680y";
    private static string h = "VHlwZSAhZmxhZyBpbiBkaXNjb3JkIGZvciB0aGUgU0VDUkVUIEVORElORw==";
    private static string i = "SG93IG1hbnkgdGltZXMgd2lsbCB5b3UgdXNlIFJTQSBpbiB0aGUgd29ya3BsYWNlPyA6RA==";
    private static string j = "KHNvbWUgb2YgdGhlc2UgZG9uJ3Qgd29yaywganVzdCBpZ25vcmUuLi5vciBtYXliZSBkb24ndD8p";
    private static string l = "SGF2ZSB5b3Ugc3R1ZGllZCBmb3IgT1NDUCB0b2RheT8=";
    private static string m = "aHR0cHM6Ly9iaXQubHkvM01sdmpSOQ==";
    private static string n = "DUCTF{";
    private static string o = "no}";
    private static string p = "4n6grl";
    private static string q = "RUFUIFNMRUVQIENURiBSRVBFQVQ=";
    private static string r = "UmVkIFRlYW0gPiBCbHVlIFRlYW0=";
    private static string s = "U3RhbmQgYmFjayBldmVyeW9uZSwgSSdtIGNlcnRpZmllZCE=";
    private static string t = "zR4WTE4d2NsOWpNREJzWDJG";
    private static string u = "WjdaREZrWDNrd2RW";
    private static string v = "SVNPMjcwMDEgU0FWRSBVUw==";
    private static string w = "Qmx1ZSBUZWFtID4gUmVkIFRlYW0=";
    private static string x = "Z2hpZHJhIHNhdmUgbWUh";
    private static string y = "QXJlIHlvdSBkZWNvZGluZyBhbGwgb2YgdGhlc2U/IFdoYXQgYSBjaGFtcCE=";
    private static string z = "Password1";

    [STAThread]
    public static void Main(string[] args)
    {
      Console.WriteLine("");
      Console.WriteLine(Program.DecodeMe("SEFIQSB5b3UgaGF2ZSBiZWVuIHRyaWNrZWQgYnkgbXkgMTMzNyBoYXh4MHIgc2tpbGxzIQ=="));
      Console.WriteLine("");
      Console.WriteLine(Program.DecodeMe("RW5jcnlwdGluZyA=") + Environment.UserName + Program.DecodeMe("J3MgZmlsZXMgaW4uLi4="));
      Thread.Sleep(1000);
      Console.WriteLine("...5");
      Thread.Sleep(1000);
      Console.WriteLine("...4");
      Thread.Sleep(1000);
      Console.WriteLine("...3");
      Thread.Sleep(1000);
      Console.WriteLine("...2");
      Thread.Sleep(1000);
      Console.WriteLine("...1");
      Thread.Sleep(1000);
      List<string> stringList = Program.SearchForFiles("C:\\Users\\" + Environment.UserName, (string[]) new string[2]
      {
        (string) "*.png",
        (string) "*.docx"
      });
      try
      {
        foreach (string str in stringList)
        {
          Console.WriteLine(str);
          Thread.Sleep(10);
        }
      }
      finally
      {
        List<string>.Enumerator enumerator;
        enumerator.Dispose();
      }
      Console.WriteLine("");
      Console.WriteLine(Program.DecodeMe("Li4uc28geW91IHdhbnQgdG8gZGVjcnlwdCB5b3VyIGZpbGVzPyBFbnRlciB0aGUgcGFzc3dvcmQ6IA=="));
      Console.WriteLine("");
      if (Operators.CompareString(Program.EncodeMe(Console.ReadLine()), Program.DecodeMe(string.Concat((string[]) new string[6]
      {
        (string) Program.d,
        (string) Program.u,
        (string) Program.c,
        (string) Program.t,
        (string) Program.f,
        (string) "="
      })), false) == 0)
        Console.WriteLine(Program.DecodeMe("VGhhdCdzIGl0ISBUaGF0J3MgdGhlIGZsYWch"));
      else
        Console.WriteLine(Program.DecodeMe("V3JvbmcgcGFzc3dvcmQsIGxvb2tzIGxpa2UgeW91ciBmaWxlcyBhcmUgVE9BU1Q="));
      Console.ReadLine();
    }

    public static List<string> SearchForFiles(string RootFolder, string[] FileFilter)
    {
      List<string> stringList = new List<string>();
      Stack<string> stringStack = new Stack<string>();
      stringStack.Push(RootFolder);
      while (stringStack.Count > 0)
      {
        string str1 = stringStack.Pop();
        try
        {
          string[] directories = Directory.GetDirectories(str1);
          int index1 = 0;
          while (index1 < directories.Length)
          {
            string str2 = directories[index1];
            stringStack.Push(str2);
            checked { ++index1; }
          }
          string[] strArray = FileFilter;
          int index2 = 0;
          while (index2 < strArray.Length)
          {
            string str3 = strArray[index2];
            stringList.AddRange((IEnumerable<string>) Directory.GetFiles(str1, str3));
            checked { ++index2; }
          }
        }
        catch (Exception ex)
        {
          ProjectData.SetProjectError(ex);
          ProjectData.ClearProjectError();
        }
      }
      return stringList;
    }

    public static string EncodeMe(string input) => Convert.ToBase64String(Encoding.UTF8.GetBytes(input));

    public static string DecodeMe(string input) => Encoding.UTF8.GetString(Convert.FromBase64String(input));
  }
}
```

T√¥i th·∫•y c√≥ h√†m `DecodeMe` m·ªü n√≥ ra xem th√¨ ƒë√¢y l√† h√†m gi·∫£i m√£ `base64`

```c#
    public static string DecodeMe(string input) => Encoding.UTF8.GetString(Convert.FromBase64String(input));
```

Do ƒë√≥ t√¥i s·∫Ω gi·∫£i m√£ c√°c ƒëo·∫°n strings c·ªßa ch∆∞∆°ng tr√¨nh xem logic c·ªßa b√†i s·∫Ω nh∆∞ n√†o. Th√¨ t√¥i ph√°t hi·ªán c√≥ h√†m `if` ki·ªÉm tra flag:

```c#
Console.WriteLine(Program.DecodeMe("...so you want to decrypt your files? Enter the password: ");
Console.WriteLine("");
if (Operators.CompareString(Program.EncodeMe(Console.ReadLine()), Program.DecodeMe(string.Concat((string[]) new string[6]
{
    (string) Program.d,
    (string) Program.u,
    (string) Program.c,
    (string) Program.t,
    (string) Program.f,
    (string) "="
})), false) == 0)
    Console.WriteLine("That's it! That's the flag!");
else
    Console.WriteLine("Wrong password, looks like your files are TOAST");
```

V√† th·∫ø l√† ƒë√£ g·∫ßn xong r·ªìi, gi·ªù ch·ªâ c·∫ßn n·ªëi c√°c chu·ªói `d,u,c,t,f,"="` r·ªìi gi·∫£i m√£ n√≥ l√† ra flag:

```shell
$echo RFVDVEZ7ZDFkX3kwdV9wYW4xY18wcl9jMDBsX2FzX2N1Y3VtYjNyfQ== | base64 --decode
```

Nh·∫≠n ƒë∆∞·ª£c flag: `DUCTF{d1d_y0u_pan1c_0r_c00l_as_cucumb3r}`ü´°

### 3: Clicky (Solved)

![·∫¢nh m√¥ t·∫£ nhi·ªám v·ª• 3](/src/2022/DownUnderCTF/clicky/img/00_title.png)

ƒê·∫øn v·ªõi th·ª≠ th√°ch n√†y ch·∫°y th√¨ ta nh·∫≠n th·∫•y th√¥ng b√°o c·∫ßn c√†i .NET, ch·ª©ng t·ªè l√† ch∆∞∆°ng tr√¨nh ch·∫°y tr√™n n·ªÅn t·∫£ng .NET

![01](/src/2022/DownUnderCTF/clicky/img/01_open.png)

Th·∫ø th√¨ ta ti·∫øp t·ª•c m·ªü b·∫±ng `dotPeek` v√† ta nh·∫≠n ƒë∆∞·ª£c:

```c#
    private void PictureBox1_Click(object sender, EventArgs e)
    {
      if (this.PictureBox1.Size.Height == 1)
      {
        int num1 = (int) MessageBox.Show("Here's the link! https://bit.ly/3MfBhmD");
      }
      if (this.PictureBox1.Size.Height == 10)
      {
        this.Timer1.Stop();
        this.lbBossFight.ForeColor = Color.Green;
        int num2 = (int) MessageBox.Show(string.Concat((string[]) new string[8]
        {
          (string) "How did you do this?!?! ",
          (string) this.Unscramble("UkZWRFZFWT0="),
          (string) this.Unscramble(this.flag),
          (string) this.Unscramble(this.Random_function(this.Label1.Text)),
          (string) this.Unscramble(this.Random_function(this.Label2.Text)),
          (string) this.Unscramble(this.Random_function(this.Label3.Text)),
          (string) "_ZGVhZGIzM2ZjYWZl",
          (string) this.Unscramble(this.galf)
        }));
      }
      if (this.PictureBox1.Size.Height == 75)
      {
        int num3 = (int) MessageBox.Show("You clicked me again! [EUROBEAT INTENSIFIES]");
        this.PictureBox1.Size = new Size(10, 10);
        this.DUCTF.Interval = 69;
        this.lbBossFight.Text = "00:00:00";
        this.lbWaterLevel.ForeColor = Color.Green;
      }
      if (this.PictureBox1.Size.Height != 100)
        return;
      int num4 = (int) MessageBox.Show("You clicked me! Time to get a bit smaller and faster!");
      this.PictureBox1.Size = new Size(75, 75);
      this.DUCTF.Interval = 420;
      this.lbWaterLevel.Text = "00:00:00";
      this.lbTutorial.ForeColor = Color.Green;
    }
```

T√¥i th·∫•y ƒëo·∫°n m√£ n√†y ƒë√°ng nghi ng·ªù n√™n t√¥i s·∫Ω l·∫ßn t√¨m theo ƒë√≥. Click ki·ªÉm tra h√†m `Unscramble` v√† c·∫£ h√†m `Non_Random_function`:

```c#
public string Unscramble(string input) => this.Non_Random_function(Encoding.UTF8.GetString(Convert.FromBase64String(input)));
public string Non_Random_function(string input) => Encoding.UTF8.GetString(Convert.FromBase64String(input));
```

v√¢ng 2 h√†m n√†y ƒë·∫°i lo·∫°i l√† gi·∫£i m√£ `base64` th√¥ng qua tham s·ªë truy·ªÅn v√†o `input`. Ta ƒëi v√†o h√†m `Unscramble` t√¥i th·∫•y n√≥ d√πng con tr·ªè this g·ªçi h√†m `Non_Random_function` -> `input` ƒë·∫ßu v√†o c·ªßa h√†m `Unscramble` s·∫Ω decode base64 2 l·∫ßn.
-> `UkZWRFZFWT0=` return sau khi g·ªçi h√†m: `DUCTF`:

```shell
$ echo UkZWRFZFWT0= | base64 --decode | base64 --decode
DUCTF
```

Ch·∫Øc l√† ta ƒëi ƒë√∫ng ƒë∆∞·ªùng r·ªìi, ti·∫øp t·ª•c th√¥i ü§™
Ti·∫øp theo l√† `this.flag` v√† `this.galf` t∆∞∆°ng t·ª± n√≥ l√† `{` v√† `}`.

Ta ƒë·∫øn v·ªõi h√†m `Random_function`:

```c#
public string Random_function(string input) => Encoding.UTF8.GetString(Convert.FromHexString(input));
```

H√†m n√†y ƒë∆°n gi·∫£n ch·ªâ l√† chuy·ªÉn ƒë·ªïi t·ª´ hex sang chu·ªói.
Ta th·∫•y c√°c `Label1`, `Label2`, `Label3`:

```c#
this.Label1.Text = "576B64736131677A62485A6B55543039";
this.Label2.Text = "57444E57656C70574F44303D";
this.Label3.Text = "57565935565646575453383D";
```

Gi·ªù t√¥i ƒëi 3 ƒëo·∫°n string n√†y l√™n **CyberChef** ta nh·∫≠n ƒë∆∞·ª£c k·∫øt qu·∫£:

![2](/src/2022/DownUnderCTF/clicky/img/02_decode_label.png)

V√† c∆° b·∫£n l√† xong gi·ªù ta ch·ªâ gom v√†o l√† ta nh·∫≠n ƒë∆∞·ª£c flag r·ªìi:
`DUCTF{did_you_use_a_TAS?_ZGVhZGIzM2ZjYWZl}`

V·∫≠y l√† xong challange 3 c≈©ng kh√° d·ªÖ d√†ng nh√©üíÄ

<!-- ### 4: js lock (Unsolved)

![·∫¢nh m√¥ t·∫£ nhi·ªám v·ª• 4](/src/2022/DownUnderCTF/js-lock/img/00_title.png)

### 5: ezpz-rev (Unsolved)

![·∫¢nh m√¥ t·∫£ nhi·ªám v·ª• 5](/src/2022/DownUnderCTF/ezpz-rev/img/00_title.png)

### 6: xva (Unsolved)

![·∫¢nh m√¥ t·∫£ nhi·ªám v·ª• 6](/src/2022/DownUnderCTF/xva/img/00_title.png)

### 7: click the flag (Unsolved)

![·∫¢nh m√¥ t·∫£ nhi·ªám v·ª• 7](/src/2022/DownUnderCTF/click-the-flag/img/00_title.png)

### 8: artisan (Unsolved)

![·∫¢nh m√¥ t·∫£ nhi·ªám v·ª• 8](/src/2022/DownUnderCTF/artisan/img/00_title.png) -->
