---
title: "DownUnderCTF 2022"
author: vietzettt
date: 2022-09-23
layout: post
cover: /src/2022/DownUnderCTF/00_img_pages/cover.webp
---

---

##### **Ngu·ªìn ·ªü ƒë√¢y nh√° c√°c b·∫°n:** [üíÄ**üëÜüëÜüëÜ**üíÄ](https://github.com/vietzettt/vietzettt.github.io/tree/main/src/2022/DownUnderCTF)

M·ªôt gi·∫£i CTF l·∫ßn ƒë·∫ßu tham gia c·ªßa t√¥i v√† team t√¥i v·ªõi nh·ªØng ki·∫øn th·ª©c t·ª± h·ªçc sau 1 th·ªùi gian. V·ªõi nhi·ªÅu challenges c·ªßa nhi·ªÅu m·∫£ng, nh∆∞ng t√¥i s·∫Ω vi·∫øt b√†i d∆∞·ªõi ƒë√¢y l√† m·∫£ng c·ªßa t√¥i y√™u th√≠ch v√† s·∫Ω ƒëi theo ƒë√≥ l√† RE, m·ªôt m·∫£ng r·∫•t c·∫ßn c∆° b·∫£n nh∆∞ ng√¥n ng·ªØ assembly x86/x64 nh√°üòÅ

Sau ƒë√¢y t√¥i v√†o vi·ªác ƒë√¢y, nay th·ªùi ti·∫øt ·ªü Nga nh∆∞ bao ng√†y √≠ √¨ y l·∫°nh)))ü•∂ √† m√† c√≥ l√≤ s∆∞·ªüi th·∫ø l√† n√≥ng l·∫Øm mn>> m√† th√¥i g√©t g√¥ü§™

### 1: source provided (Solved)

![·∫¢nh m√¥ t·∫£ nhi·ªám v·ª• 1](/src/2022/DownUnderCTF/source-provided/img/00_title.png)

Th·ª≠ th√°ch ƒë·∫ßu ti√™n l√† beginner th·∫ø n√™n t√¥i tin l√† n√≥ s·∫Ω kh√¥ng qu√° kh√≥ nh·ªâ

T√¥i t·∫£i c√°c file v·ªÅ v√† m·ªü file `chall.S`:

```code
SECTION .data
c db 0xc4, 0xda, 0xc5, 0xdb, 0xce, 0x80, 0xf8, 0x3e, 0x82, 0xe8, 0xf7, 0x82, 0xef, 0xc0, 0xf3, 0x86, 0x89, 0xf0, 0xc7, 0xf9, 0xf7, 0x92, 0xca, 0x8c, 0xfb, 0xfc, 0xff, 0x89, 0xff, 0x93, 0xd1, 0xd7, 0x84, 0x80, 0x87, 0x9a, 0x9b, 0xd8, 0x97, 0x89, 0x94, 0xa6, 0x89, 0x9d, 0xdd, 0x94, 0x9a, 0xa7, 0xf3, 0xb2

SECTION .text

global main

main:
    xor rax, rax
    xor rdi, rdi
    mov rdx, 0x32
    sub rsp, 0x32
    mov rsp, rsi
    syscall

    mov r10, 0
l:
    movzx r11, byte [rsp + r10]
    movzx r12, byte [c + r10]
    add r11, r10
    add r11, 0x42
    xor r11, 0x42
    and r11, 0xff
    cmp r11, r12
    jne b

    add r10, 1
    cmp r10, 0x32
    jne l

    mov rax, 0x3c
    mov rdi, 0
    syscall

b:
    mov rax, 0x3c
    mov rdi, 1
    syscall

```

ƒê√¢y l√† file ƒë∆∞·ª£c vi·∫øt d∆∞·ªõi d·∫°ng **asm x86**, do ƒë√≥ ta ƒëi v√†o ƒë·ªçc xem th·∫ø n√†o nh√©

```code
SECTION .data ; ƒë√¢y l√† m·∫£ng c√°c s·ªë c√≥ th·ªÉ ƒë·ªÉ s·ª≠ d·ª•ng n√≥ ƒë·ªÉ t·∫°o th√†nh flag
c db 0xc4, 0xda, 0xc5, 0xdb, 0xce, 0x80, 0xf8, 0x3e, 0x82, 0xe8, 0xf7, 0x82, 0xef, 0xc0, 0xf3, 0x86, 0x89, 0xf0, 0xc7, 0xf9, 0xf7, 0x92, 0xca, 0x8c, 0xfb, 0xfc, 0xff, 0x89, 0xff, 0x93, 0xd1, 0xd7, 0x84, 0x80, 0x87, 0x9a, 0x9b, 0xd8, 0x97, 0x89, 0x94, 0xa6, 0x89, 0x9d, 0xdd, 0x94, 0x9a, 0xa7, 0xf3, 0xb2

SECTION .text

global main

main:                   ; ƒëi v√†o h√†m n√†o
    xor rax, rax        ; rax = 0
    xor rdi, rdi        ; rdx = 0
    mov rdx, 0x32       ; rdx = 0x32
    sub rsp, 0x32       ; rsp = rsp - 0x32
    mov rsp, rsi
    syscall

    mov r10, 0          ; r10 = 0
l:
    movzx r11, byte [rsp + r10]    ; c√≥ l·∫Ω c√°i n√†y n√≥ l√† input ƒë·∫ßu v√†o
    movzx r12, byte [c + r10]      ; c√≤n c√°i n√†y .data c 
    add r11, r10                   ; input = input + r10 (kh·∫£ nƒÉng add v·ªõi index c·ªßa n√≥)
    add r11, 0x42                  ; input = input + 0x42
    xor r11, 0x42                  ; input = input ^ 0x42
    and r11, 0xff                  ; input = input & 0xff
    cmp r11, r12                   ; so s√°nh input v·ªõi t·ª´ng gi√° tr·ªã trong .data
    jne b                          ; jump if not equal

    add r10, 1                     ; c√≥ th·ªÉ hi·ªÉu ind++
    cmp r10, 0x32                  ; so s√°nh n√≥ v·ªõi 0x32
    jne l                          ; jump if not equal 

    mov rax, 0x3c                  
    mov rdi, 0                      ; return 0 (th·ªèa m√£n)
    syscall

b:
    mov rax, 0x3c 
    mov rdi, 1                      ; c√≥ th·ªÉ hi·ªÉu l√† return 1 (l·ªói)
    syscall

```

T·ª´ ph√¢n t√≠ch tr√™n th√¨ ta th·∫•y r√µ b√†i n√†y s·∫Ω y√™u c·∫ßu ta nh·∫≠p `input` flag r·ªìi r·ªìi m√£ h√≥a t·ª´ng k√≠ t·ª± c·ªßa `input` ƒëem so s√°nh v·ªõi `c`
V·ªõi b√†i n√†y ch·ªâ s·ª≠ d·ª•ng to√°n t·ª≠ `xor, and, add` n√™n t√¥i s·∫Ω ƒë·∫£o ng∆∞·ª£c l·∫°i qu√° tr√¨nh n√≥ v·ªõi `c` l√† ƒë·∫ßu v√†o v√† `print` k·∫øt qu·∫£ nh·∫≠n ƒë∆∞·ª£c.
V√† ƒë√¢y l√† source Python t√¥i code ƒë·ªÉ t·∫°o flag:

```python
c = [0xc4, 0xda, 0xc5, 0xdb, 0xce, 0x80, 0xf8, 0x3e, 0x82, 0xe8, 0xf7, 0x82, 0xef, 0xc0, 0xf3, 0x86, 0x89, 0xf0, 0xc7, 0xf9, 0xf7, 0x92, 0xca, 0x8c, 0xfb, 0xfc, 0xff, 0x89, 0xff, 0x93, 0xd1, 0xd7, 0x84, 0x80, 0x87, 0x9a, 0x9b, 0xd8, 0x97, 0x89, 0x94, 0xa6, 0x89, 0x9d, 0xdd, 0x94, 0x9a, 0xa7, 0xf3, 0xb2]

flag = []
for i, x in enumerate(c):
    b = ((x ^ 0x42) - 0x42 - i) % 256
    flag.append(b)
print(bytes(flag).decode())
```

V√† ch·∫°y n√≥ ta nh·∫≠n ƒë∆∞·ª£c flag: `DUCTF{r3v_is_3asy_1f_y0u_can_r34d_ass3mbly_r1ght?}`
V√† ch√∫c m·ª´ng ta ƒë√£ ho√†n th√†nh xong task ƒë·∫ßu ti√™n nh√°.

### 2: Legit App Not Ransomware (Solved)

![·∫¢nh m√¥ t·∫£ nhi·ªám v·ª• 2](/src/2022/DownUnderCTF/legit-app-not-ransomware/img/00_title.png)

K·∫øt qu·∫£ t√¥i ch·∫°y th·ª≠ ch∆∞∆°ng tr√¨nh:

![run file](/src/2022/DownUnderCTF/legit-app-not-ransomware/img/01_run_file.png)

Ta nh·∫≠n ƒë∆∞·ª£c k·∫øt qu·∫£ l√† y√™u c·∫ßu ta ch·∫°y tr√™n n·ªÅn t·∫£ng `.NET`, do ƒë√≥ ta c√≥ th·ªÉ s·ª≠ d·ª•ng c√°c ph·∫ßm m·ªÅm nh∆∞ dotPeek, ilspy, dnSpy,...
T√¥i s·∫Ω ch·∫°y ch∆∞∆°ng tr√¨nh b·∫±ng dotPeek, t√¨m ki·∫øm strings v√† c√°c h√†m, ƒë·ªÉ xem h√†m `main` ·ªü ƒë√¢u v√† th·ª±c hi·ªán g√¨:

![2](/src/2022/DownUnderCTF/legit-app-not-ransomware/img/02.png)

D∆∞·ªõi ƒë√¢y l√† code c·ªßa to√†n ch∆∞∆°ng tr√¨nh khi dotPeek gi·∫£i cho ta:

```c#
using Microsoft.VisualBasic.CompilerServices;
using System;
using System.Collections.Generic;
using System.IO;
using System.Text;
using System.Threading;

namespace LegitAppNotRansomware
{
  [StandardModule]
  internal sealed class Program
  {
    private static string a = "d3Jvbmdv";
    private static string b = "aHR0cHM6Ly9iaXQubHkvM05SMkVvYg==";
    private static string c = "OXdZV";
    private static string d = "UkZWRFZF";
    private static string e = "J1mM7";
    private static string f = "elgyTjFZM1Z0WWpOeWZRPT0";
    private static string g = "4n680y";
    private static string h = "VHlwZSAhZmxhZyBpbiBkaXNjb3JkIGZvciB0aGUgU0VDUkVUIEVORElORw==";
    private static string i = "SG93IG1hbnkgdGltZXMgd2lsbCB5b3UgdXNlIFJTQSBpbiB0aGUgd29ya3BsYWNlPyA6RA==";
    private static string j = "KHNvbWUgb2YgdGhlc2UgZG9uJ3Qgd29yaywganVzdCBpZ25vcmUuLi5vciBtYXliZSBkb24ndD8p";
    private static string l = "SGF2ZSB5b3Ugc3R1ZGllZCBmb3IgT1NDUCB0b2RheT8=";
    private static string m = "aHR0cHM6Ly9iaXQubHkvM01sdmpSOQ==";
    private static string n = "DUCTF{";
    private static string o = "no}";
    private static string p = "4n6grl";
    private static string q = "RUFUIFNMRUVQIENURiBSRVBFQVQ=";
    private static string r = "UmVkIFRlYW0gPiBCbHVlIFRlYW0=";
    private static string s = "U3RhbmQgYmFjayBldmVyeW9uZSwgSSdtIGNlcnRpZmllZCE=";
    private static string t = "zR4WTE4d2NsOWpNREJzWDJG";
    private static string u = "WjdaREZrWDNrd2RW";
    private static string v = "SVNPMjcwMDEgU0FWRSBVUw==";
    private static string w = "Qmx1ZSBUZWFtID4gUmVkIFRlYW0=";
    private static string x = "Z2hpZHJhIHNhdmUgbWUh";
    private static string y = "QXJlIHlvdSBkZWNvZGluZyBhbGwgb2YgdGhlc2U/IFdoYXQgYSBjaGFtcCE=";
    private static string z = "Password1";

    [STAThread]
    public static void Main(string[] args)
    {
      Console.WriteLine("");
      Console.WriteLine(Program.DecodeMe("SEFIQSB5b3UgaGF2ZSBiZWVuIHRyaWNrZWQgYnkgbXkgMTMzNyBoYXh4MHIgc2tpbGxzIQ=="));
      Console.WriteLine("");
      Console.WriteLine(Program.DecodeMe("RW5jcnlwdGluZyA=") + Environment.UserName + Program.DecodeMe("J3MgZmlsZXMgaW4uLi4="));
      Thread.Sleep(1000);
      Console.WriteLine("...5");
      Thread.Sleep(1000);
      Console.WriteLine("...4");
      Thread.Sleep(1000);
      Console.WriteLine("...3");
      Thread.Sleep(1000);
      Console.WriteLine("...2");
      Thread.Sleep(1000);
      Console.WriteLine("...1");
      Thread.Sleep(1000);
      List<string> stringList = Program.SearchForFiles("C:\\Users\\" + Environment.UserName, (string[]) new string[2]
      {
        (string) "*.png",
        (string) "*.docx"
      });
      try
      {
        foreach (string str in stringList)
        {
          Console.WriteLine(str);
          Thread.Sleep(10);
        }
      }
      finally
      {
        List<string>.Enumerator enumerator;
        enumerator.Dispose();
      }
      Console.WriteLine("");
      Console.WriteLine(Program.DecodeMe("Li4uc28geW91IHdhbnQgdG8gZGVjcnlwdCB5b3VyIGZpbGVzPyBFbnRlciB0aGUgcGFzc3dvcmQ6IA=="));
      Console.WriteLine("");
      if (Operators.CompareString(Program.EncodeMe(Console.ReadLine()), Program.DecodeMe(string.Concat((string[]) new string[6]
      {
        (string) Program.d,
        (string) Program.u,
        (string) Program.c,
        (string) Program.t,
        (string) Program.f,
        (string) "="
      })), false) == 0)
        Console.WriteLine(Program.DecodeMe("VGhhdCdzIGl0ISBUaGF0J3MgdGhlIGZsYWch"));
      else
        Console.WriteLine(Program.DecodeMe("V3JvbmcgcGFzc3dvcmQsIGxvb2tzIGxpa2UgeW91ciBmaWxlcyBhcmUgVE9BU1Q="));
      Console.ReadLine();
    }

    public static List<string> SearchForFiles(string RootFolder, string[] FileFilter)
    {
      List<string> stringList = new List<string>();
      Stack<string> stringStack = new Stack<string>();
      stringStack.Push(RootFolder);
      while (stringStack.Count > 0)
      {
        string str1 = stringStack.Pop();
        try
        {
          string[] directories = Directory.GetDirectories(str1);
          int index1 = 0;
          while (index1 < directories.Length)
          {
            string str2 = directories[index1];
            stringStack.Push(str2);
            checked { ++index1; }
          }
          string[] strArray = FileFilter;
          int index2 = 0;
          while (index2 < strArray.Length)
          {
            string str3 = strArray[index2];
            stringList.AddRange((IEnumerable<string>) Directory.GetFiles(str1, str3));
            checked { ++index2; }
          }
        }
        catch (Exception ex)
        {
          ProjectData.SetProjectError(ex);
          ProjectData.ClearProjectError();
        }
      }
      return stringList;
    }

    public static string EncodeMe(string input) => Convert.ToBase64String(Encoding.UTF8.GetBytes(input));

    public static string DecodeMe(string input) => Encoding.UTF8.GetString(Convert.FromBase64String(input));
  }
}
```

T√¥i th·∫•y c√≥ h√†m `DecodeMe` m·ªü n√≥ ra xem th√¨ ƒë√¢y l√† h√†m gi·∫£i m√£ `base64`

```c#
    public static string DecodeMe(string input) => Encoding.UTF8.GetString(Convert.FromBase64String(input));
```

Do ƒë√≥ t√¥i s·∫Ω gi·∫£i m√£ c√°c ƒëo·∫°n strings c·ªßa ch∆∞∆°ng tr√¨nh xem logic c·ªßa b√†i s·∫Ω nh∆∞ n√†o. Th√¨ t√¥i ph√°t hi·ªán c√≥ h√†m `if` ki·ªÉm tra flag:

```c#
Console.WriteLine(Program.DecodeMe("...so you want to decrypt your files? Enter the password: ");
Console.WriteLine("");
if (Operators.CompareString(Program.EncodeMe(Console.ReadLine()), Program.DecodeMe(string.Concat((string[]) new string[6]
{
    (string) Program.d,
    (string) Program.u,
    (string) Program.c,
    (string) Program.t,
    (string) Program.f,
    (string) "="
})), false) == 0)
    Console.WriteLine("That's it! That's the flag!");
else
    Console.WriteLine("Wrong password, looks like your files are TOAST");
```

V√† th·∫ø l√† ƒë√£ g·∫ßn xong r·ªìi, gi·ªù ch·ªâ c·∫ßn n·ªëi c√°c chu·ªói `d,u,c,t,f,"="` r·ªìi gi·∫£i m√£ n√≥ l√† ra flag:

```shell
$echo RFVDVEZ7ZDFkX3kwdV9wYW4xY18wcl9jMDBsX2FzX2N1Y3VtYjNyfQ== | base64 --decode
```

Nh·∫≠n ƒë∆∞·ª£c flag: `DUCTF{d1d_y0u_pan1c_0r_c00l_as_cucumb3r}`ü´°

### 3: Clicky (Solved)

![·∫¢nh m√¥ t·∫£ nhi·ªám v·ª• 3](/src/2022/DownUnderCTF/clicky/img/00_title.png)

ƒê·∫øn v·ªõi th·ª≠ th√°ch n√†y ch·∫°y th√¨ ta nh·∫≠n th·∫•y th√¥ng b√°o c·∫ßn c√†i .NET, ch·ª©ng t·ªè l√† ch∆∞∆°ng tr√¨nh ch·∫°y tr√™n n·ªÅn t·∫£ng .NET

![01](/src/2022/DownUnderCTF/clicky/img/01_open.png)

Th·∫ø th√¨ ta ti·∫øp t·ª•c m·ªü b·∫±ng `dotPeek` v√† ta nh·∫≠n ƒë∆∞·ª£c:

```c#
    private void PictureBox1_Click(object sender, EventArgs e)
    {
      if (this.PictureBox1.Size.Height == 1)
      {
        int num1 = (int) MessageBox.Show("Here's the link! https://bit.ly/3MfBhmD");
      }
      if (this.PictureBox1.Size.Height == 10)
      {
        this.Timer1.Stop();
        this.lbBossFight.ForeColor = Color.Green;
        int num2 = (int) MessageBox.Show(string.Concat((string[]) new string[8]
        {
          (string) "How did you do this?!?! ",
          (string) this.Unscramble("UkZWRFZFWT0="),
          (string) this.Unscramble(this.flag),
          (string) this.Unscramble(this.Random_function(this.Label1.Text)),
          (string) this.Unscramble(this.Random_function(this.Label2.Text)),
          (string) this.Unscramble(this.Random_function(this.Label3.Text)),
          (string) "_ZGVhZGIzM2ZjYWZl",
          (string) this.Unscramble(this.galf)
        }));
      }
      if (this.PictureBox1.Size.Height == 75)
      {
        int num3 = (int) MessageBox.Show("You clicked me again! [EUROBEAT INTENSIFIES]");
        this.PictureBox1.Size = new Size(10, 10);
        this.DUCTF.Interval = 69;
        this.lbBossFight.Text = "00:00:00";
        this.lbWaterLevel.ForeColor = Color.Green;
      }
      if (this.PictureBox1.Size.Height != 100)
        return;
      int num4 = (int) MessageBox.Show("You clicked me! Time to get a bit smaller and faster!");
      this.PictureBox1.Size = new Size(75, 75);
      this.DUCTF.Interval = 420;
      this.lbWaterLevel.Text = "00:00:00";
      this.lbTutorial.ForeColor = Color.Green;
    }
```

T√¥i th·∫•y ƒëo·∫°n m√£ n√†y ƒë√°ng nghi ng·ªù n√™n t√¥i s·∫Ω l·∫ßn t√¨m theo ƒë√≥. Click ki·ªÉm tra h√†m `Unscramble` v√† c·∫£ h√†m `Non_Random_function`:

```c#
public string Unscramble(string input) => this.Non_Random_function(Encoding.UTF8.GetString(Convert.FromBase64String(input)));
public string Non_Random_function(string input) => Encoding.UTF8.GetString(Convert.FromBase64String(input));
```

v√¢ng 2 h√†m n√†y ƒë·∫°i lo·∫°i l√† gi·∫£i m√£ `base64` th√¥ng qua tham s·ªë truy·ªÅn v√†o `input`. Ta ƒëi v√†o h√†m `Unscramble` t√¥i th·∫•y n√≥ d√πng con tr·ªè this g·ªçi h√†m `Non_Random_function` -> `input` ƒë·∫ßu v√†o c·ªßa h√†m `Unscramble` s·∫Ω decode base64 2 l·∫ßn.
-> `UkZWRFZFWT0=` return sau khi g·ªçi h√†m: `DUCTF`:

```shell
$ echo UkZWRFZFWT0= | base64 --decode | base64 --decode
DUCTF
```

Ch·∫Øc l√† ta ƒëi ƒë√∫ng ƒë∆∞·ªùng r·ªìi, ti·∫øp t·ª•c th√¥i ü§™
Ti·∫øp theo l√† `this.flag` v√† `this.galf` t∆∞∆°ng t·ª± n√≥ l√† `{` v√† `}`.

Ta ƒë·∫øn v·ªõi h√†m `Random_function`:

```c#
public string Random_function(string input) => Encoding.UTF8.GetString(Convert.FromHexString(input));
```

H√†m n√†y ƒë∆°n gi·∫£n ch·ªâ l√† chuy·ªÉn ƒë·ªïi t·ª´ hex sang chu·ªói.
Ta th·∫•y c√°c `Label1`, `Label2`, `Label3`:

```c#
this.Label1.Text = "576B64736131677A62485A6B55543039";
this.Label2.Text = "57444E57656C70574F44303D";
this.Label3.Text = "57565935565646575453383D";
```

Gi·ªù t√¥i ƒëi 3 ƒëo·∫°n string n√†y l√™n **CyberChef** ta nh·∫≠n ƒë∆∞·ª£c k·∫øt qu·∫£:

![2](/src/2022/DownUnderCTF/clicky/img/02_decode_label.png)

V√† c∆° b·∫£n l√† xong gi·ªù ta ch·ªâ gom v√†o l√† ta nh·∫≠n ƒë∆∞·ª£c flag r·ªìi:
`DUCTF{did_you_use_a_TAS?_ZGVhZGIzM2ZjYWZl}`

V·∫≠y l√† xong challange 3 c≈©ng kh√° d·ªÖ d√†ng nh√©üíÄ

### 4: js lock (Unsolved)

![·∫¢nh m√¥ t·∫£ nhi·ªám v·ª• 4](/src/2022/DownUnderCTF/js-lock/img/00_title.png)

V·ªõi th·ª≠ th√°ch n√†y l√† m·ªôt th·ª≠ th√°ch li√™n quan ƒë·∫øn `js` m·ªü ch∆∞∆°ng tr√¨nh v√† ph√¢n t√≠ch m·ªôt ch√∫t:ü´°

![lock show](/src/2022/DownUnderCTF/js-lock/img/01_lock_show.png)

ƒë√¢y l√† l√≠ do t√¥i kh√¥ng gi·∫£i quy·∫øt ƒë∆∞·ª£c nhi·ªám v·ª• n√†y l√† ph√¢n t√≠ch ƒë∆∞·ª£c c√°c LOCK l√† g√¨????üò•üò™. Bi·∫øn `LOCK` l√† m·ªôt m·∫£ng l·ªõn c√°c s·ªë ƒë∆∞·ª£c l·ªìng v√†o nhau.

![show LOCK convert](/src/2022/DownUnderCTF/js-lock/img/03_show_LOCK_convert.png)

M·ªü file n√†y l√™n tr√¨nh duy·ªát ta th·∫•y giao di·ªán c√≥ 3 n√∫t `0` `1` `Unlock`, ch·∫Øc h·∫≥n l√† ta c·∫ßn m·ªü kh√≥a r·ªìi r·ªìi s·∫Ω n√≥ ra `flag` cho m√¨nh.

![show file](/src/2022/DownUnderCTF/js-lock/img/02_show_file_chome.png)

ƒê·ªçc ti·∫øp file v·ª´a m·ªü ƒë·ªÉ hi·ªÉu ƒë∆∞·ª£c c∆° ch·∫ø nh·∫≠n `Flag`

```html
<html>
    <body>
        <script>
.... // ƒë√¢y l√† bi·∫øn LOCK v√¨ n√≥ l·ªõn qu√° l√™n k ch√©p v√†o

const C = [62, 223, 233, 153, 37, 113, 79, 195, 9, 58, 83, 39, 245, 213, 253, 138, 225, 232, 123, 90, 8, 98, 105, 1, 31, 198, 67, 83, 41, 139, 118, 138, 252, 165, 214, 158, 116, 173, 174, 161, 6, 233, 37, 35, 86, 7, 108, 223, 97, 251, 2, 245, 129, 118, 227, 120, 26, 70, 40, 26, 183, 90, 172, 155]

            function set_status(s) {
                document.getElementById('status').innerHTML = s
            }

            function disable() {
                document.getElementById('btn-0').disabled = true
                document.getElementById('btn-1').disabled = true
                document.getElementById('submit').disabled = true
            }

            function sha512(m) {
                return crypto.subtle.digest('SHA-512', new TextEncoder('utf-8').encode(m))
                    .then((b) => new Uint8Array(b))
            }

            const S = { current: 1, key: '', T: LOCK, idx: 0 }

            function hit_0() { //khi nh·∫•n 0 th√¨ key s·∫Ω c·ªông th√™m '0' v√† ki·ªÉm tra ki·ªÉu c·ªßa S.T v√† gi√° tr·ªã x√°c ƒë·ªãnh c·ªßa S.T t·∫°i index hi·ªán t·∫°i
                S.key += '0'
                if(typeof S.T != 'object' || S.T[S.idx] == undefined) {
                    set_status(`<div style="color: red">Pin ${S.current} is stuck!</div>`)
                    disable()
                } else {
                    S.T = S.T[S.idx] // n·∫øu t·ªìn t·∫°i gi√° tr·ªã c·ªßa S.T t·∫°i index th√¨ S.T ƒë∆∞·ª£c g√°n gi√° tr·ªã c·ªßa S.T t·∫°i index ƒë√≥ sau ƒë√≥ s·∫Ω ƒë·∫∑t l·∫°i gi√° tr·ªã c·ªßa index = 0 
                    S.idx = 0
                    document.getElementById('current-attempt').innerText = S.key
                }
            }

            function hit_1() { //khi nh·∫•n 1 th√¨ s.key += '1'; index c·ªßa s s·∫Ω tƒÉng l√™n 1 
                S.key += '1'
                S.idx += 1
                document.getElementById('current-attempt').innerText = S.key
            }

            function submit_pin() {
                S.idx = 0 // g√°n gi√° tr·ªã cho index = 0
                if(S.T === S.current) { // s·∫Ω ki·ªÉm tra n·∫øu gi√° tr·ªã m√† nh·∫•n hit_0 v·ª´a xong m√† b·∫±ng v·ªõi gi√° tr·ªã s.current th√¨ s·∫Ω hi·ªÉn th·ªã ƒë√£ unlockkkkkkk
                    set_status(`<div style="color: green">Pin ${S.current} unlocked!</div>`)

                    if(S.current == 1337) { // chuy·ªÉn ƒë·∫øn h√†m nh·∫≠n flag
                        win()
                    } else { // n·∫øu kh√¥ng b·∫±ng 1337 th√¨ current tƒÉng l√™n 1 v√† ti·∫øp t·ª•c .....
                        S.current += 1
                        document.getElementById("current-pin").innerText = S.current
                        S.T = LOCK
                    }
                } else { // c√≤n n·∫øu kh√¥ng b·∫±ng th√¨ s·∫Ω d·ª´ng ch∆∞∆°ng tr√¨nh
                    set_status(`<div style="color: red">Pin ${S.current} didn\'t unlock!</div>`)
                    disable()
                }
            }

            async function win() {
                const K = await sha512(S.key) // K  = chu·ªói c·ªßa sha512 c·ªßa s.key nh·∫≠n ƒë∆∞·ª£c m√† ta tr·∫£i qua ƒë·ªß 1337 l·∫ßn unlock
                const dec = []
                for(var i = 0; i < 64; i++) {
                    dec.push(String.fromCodePoint(C[i] ^ K[i])) // flag s·∫Ω l√† k·∫øt qu·∫£ c·ªßa xor l·∫ßn l∆∞·ª£t t·ª´ng bytes c·ªßa K so v·ªõi C t∆∞∆°ng ·ª©ng 
                }
                const flag = dec.join('')
                set_status(flag)
            }

        </script>
    </body>
</html>

```

Bi·∫øn `s` ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ theo d√µi tr·∫°ng th√°i c·ªßa kh√≥a v√† ƒë∆∞·ª£c s·ª≠a ƒë·ªïi b·∫•t c·ª© khi n√†o ch√∫ng ta nh·∫•n m·ªôt trong c√°c n√∫t

Ph·∫£i tr·∫£i qua ƒë·ªß **1337** l·∫ßn unlock th√¨ m·ªõi c√≥ flag (ban ƒë·∫ßu current = 1, sau m·ªói l·∫ßn `submit_pin` th√¨ s·∫Ω ƒë∆∞·ª£c tƒÉng 1 n·∫øu pin ƒë√∫ng ƒë·ªÉ m·ªü m√†n).

C√°i kh√≥ c·ªßa b√†i n√†y l√† ta l√†m sao ƒë·ªÉ `hit_0` v√† `hit_1` l√†m sao ƒëi v√†o ƒë∆∞·ª£c m·∫£ng l·ªõn l·ªìng nhau c·ªßa `LOCK` ƒë·ªÉ bi·∫øt ƒë∆∞·ª£c index c·ªßa n√≥ l√† g√¨ r·ªìi t·ª´ ƒë√≥ ta `hit_1` b·∫•y nhi√™u l·∫ßn r·ªìi `hit_0` ƒë·ªÉ g√°n gi√° tr·ªã r·ªìi `unlock` ƒë·ªÉ so s√°nh tr·∫£ k·∫øt qu·∫£.

![show arr lock](/src/2022/DownUnderCTF/js-lock/img/04_show_lock_arr.png)

Ta th·∫•y c√°c s·ªë t·ª´ 1 -> 1337 ƒë∆∞·ª£c n·∫±m d·∫£i r√°c ·ªü trong t·∫•t c·∫£ c√°c s·ªë 0. Ta nghƒ© v·ªÅ c√°c h√†m `hit_0` v√† `hit_1` chuy·ªÉn ƒë·ªông trong m·∫£ng l·ªõn. `hit_1` ƒëi qua ph·∫ßn t·ª≠ ti·∫øp th∆∞o trong m·∫£ng, trong khi `hit_0` s·∫Ω chuy·ªÉn qua m·ªôt c·∫•p ƒë·ªô s√¢u h∆°n trong m·∫£ng. ƒê·ªÉ m·ªü kh√≥a m·ªói pin th√¨ ch√∫ng ta ph·∫£i chuy·ªÉn ƒë·ªông `hit_1` v√† `hit_0` ƒë·ªÉ di chuy·ªÉn ƒë·∫øn c√°c s·ªë theo th·ª© t·ª± t·ª´ 1 ƒë·∫øn 1337.

D∆∞·ªõi ƒë√¢y l√† √Ω t∆∞·ªüng c·ªßa h·ªç t·∫£i l√™n:

```js
set_status = console.log;

const path_to_key = (path) => path.map(c => '1'.repeat(c) + '0').join('');
const paths = Array(1337);

function dft(s, path=[]) {
  s.forEach((c, i) => {
    const curPath = [...path, i];
    if(typeof c === 'object') {
      dft(c, curPath);
    } else if(typeof c === 'number' && c !== 0) {
      paths[c - 1] = path_to_key(curPath);
    }
  })
}

dft(LOCK);

S.key = paths.join('');
await win();
```

Ch√∫ng ta c√πng ph√¢n t√≠ch n√≥ ƒë·ªÉ hi·ªÉu v√† thu n·∫°p ki·∫øn th·ª©c nh√©üòÅ:

- `map()`method ƒë∆∞·ª£c d√πng khi b·∫°n mu·ªën thao t√°c tr√™n 1 m·∫£ng v√† mu·ªën tr·∫£ v·ªÅ 1 m·∫£ng c√°c gi√° tr·ªã thay ƒë·ªïi d·ª±a tr√™n gi√° tr·ªã c·ªßa m·∫£ng ƒë·∫ßu v√†o
- `forEach()` method ƒë∆∞·ª£c d√πng ƒë·ªÉ l·∫•y c√°c ph·∫ßn t·ª≠ trong m·∫£ng theo th·ª© t·ª± v√† chuy·ªÉn ch√∫ng ƒë·∫øn h√†m callback ƒë·ªÉ x·ª≠ l√Ω. V√≤ng l·∫∑p trong forEach kh√¥ng th·ªÉ d·ª´ng l·∫°i gi·ªØa ch·ª´ng v√† s·ªë l·∫ßn l·∫∑p s·∫Ω lu√¥n b·∫±ng v·ªõi s·ªë ph·∫ßn t·ª≠ c√≥ trong m·∫£ng ban ƒë·∫ßu

D∆∞·ªõi ƒë√¢y ta s·∫Ω ph√¢n t√≠ch c√°ch gi·∫£i n√≥ nh√©:

```python

import sys
sys.setrecursionlimit(2**22)

from hashlib import sha512
from json import loads
from base64 import b64decode

LOCK = loads(b64decode(open('./LOCK.b64', 'rb').read()).decode()) #t·∫°o bi·∫øn LOCK (ch√©p chu·ªói d√†i √¥i d·ªìi v√†o file m·ªõi c√≥ t√™n LOCK.b64)
# v√¨ LOCK ƒë·ªÅ b√†i cho b·∫±ng eval() -> n√≥ m√£ h√≥a base64
ct = bytes([62, 223, 233, 153, 37, 113, 79, 195, 9, 58, 83, 39, 245, 213, 253, 138, 225, 232, 123, 90, 8, 98, 105, 1, 31, 198, 67, 83, 41, 139, 118, 138, 252, 165, 214, 158, 116, 173, 174, 161, 6, 233, 37, 35, 86, 7, 108, 223, 97, 251, 2, 245, 129, 118, 227, 120, 26, 70, 40, 26, 183, 90, 172, 155]) #t·ª´ ƒë·ªÅ b√†i
def find_key(T, k, path=''):
    if T == k:
        return path
    if type(T) is list:
        for i, t in enumerate(T):
            r = find_key(t, k, path + '1'*i + '0')
            if r:
                return r

def check_key(h, k):
    T = LOCK
    idx = 0
    for i in h:
        if i == '1':
            idx += 1
        if i == '0':
            T = T[idx]
            idx = 0
    return T == k

key = ''
for k in range(1, 1338):
    h = find_key(LOCK, k)
    key += h
    assert check_key(h, k)

key = sha512(key.encode()).digest()
flag = bytes([a ^ b for a, b in zip(ct, key)])
print(flag.decode())

```

- `bytes()` in python - return c√°c ƒë·ªëi t∆∞·ª£ng byte l√† m·ªôt chu·ªói c√°c s·ªë nguy√™n, kh√¥ng th·ªÉ thay ƒë·ªïi, ƒë∆∞·ª£c kh·ªüi t·∫°o size v√† d·ªØ li·ªáu cho tr∆∞·ªõc, trong ph·∫°m vi 0 <= x < 256.
  - **C√∫ ph√°p:**  `bytes([source[, encoding[, errors]]])`
  - **source**: t·ª± ch·ªçn
  - **encoding**: t√πy ch·ªçn, n·∫øu ngu·ªìn l√† string th√¨ ƒë√¢y l√† m√£ h√≥a c·ªßa string ƒë√≥
  - **errors**: t√πy ch·ªçn, n·∫øu ngu·ªìn l√† string, h√†nh ƒë·ªông s·∫Ω ƒë∆∞·ª£c th·ª±c hi·ªán khi qu√° tr√¨nh b·ªã l·ªói

    ```python
    # V√≠ d·ª•: Chuy·ªÉn ƒë·ªïi string th√†nh byte: 
    string = "H·ªçc Python tr√™n quantrimang.com th·∫≠t vui."
    #string v·ªõi m√£ h√≥a 'utf-8'
    mang = bytes(string, 'utf-8')
    print(mang)
    #N·∫øu in t·ª´ng ph·∫ßn t·ª≠ c√≥ trong `mang` th√¨ s·∫Ω l√† v·ªã tr√≠ c·ªßa string ƒë√≥ trong b·∫£ng asccii 2
    ```

    ```python
    # V√≠ d·ª•: T·∫°o m·∫£ng s·ªë nguy√™n v·ªõi size cho tr∆∞·ªõc: 
    size = 5
    mang = bytes(size)
    print(mang)
    #b'x00x00x00x00x00'
    ```

- `bytearray()` in python tr·∫£ v·ªÅ m·ªôt m·∫£ng byte v·ªõi k√≠ch th∆∞·ªõc cho tr∆∞·ªõc v√† c√°c gi√° tr·ªã kh·ªüi t·∫°o

- `enumerate()` in python th·ª±c s·ª± c√≥ r·∫•t nhi·ªÅu s·ª©c m·∫°nh nh∆∞:
  - H√†m cho ph√©p truy nh·∫≠p v√≤ng l·∫∑p l·∫ßn l∆∞·ª£t qua c√°c th√†nh ph·∫ßn c·ªßa m·ªôt collection trong khi n√≥ v·∫´n gi·ªØ index c·ªßa item hi·ªán t·∫°i

    ```python
    names = ['Bob', 'Alice', 'Guido']
    for index, value in enumerate(names):
      print(f'{index}: {value}')
    #output: 
    #0: Bob
    #1: Alice
    #2: Guido
    ```

  - Thay ƒë·ªïi starting index

    ```python
    names = ['Bob', 'Alice', 'Guido']
    for index, value in enumerate(names, 1):
      print(f'{index}: {value}')
    #output: 
    #1: Bob
    #2: Alice
    #3: Guido
    ```

Th·∫ø th√¥i v·∫≠y gi·ªù qua file gi·∫£i b·∫±ng python v√† nh·∫≠n ƒë∆∞·ª£c flag: `DUCTF{s3arch1ng_thr0ugh_an_arr4y_1s_n0t_th4t_h4rd_ab894d8dfea17}`. V√¢ng n√≥i chung th√¨ ƒë·ªçc code th√¨ kh√≥ khƒÉn m·ªói ƒëo·∫°n ƒëi s√¢u v√†o m·∫£ng l·ªõn üò™üò™üò™

<!-- ### 5: ezpz-rev (Unsolved)

![·∫¢nh m√¥ t·∫£ nhi·ªám v·ª• 5](/src/2022/DownUnderCTF/ezpz-rev/img/00_title.png)

`setz cl` - ƒë·∫∑t byte cl th√†nh 1 n·∫øu c·ªù Zero (ZF) ƒë∆∞·ª£c ƒë·∫∑t, ng∆∞·ª£c l·∫°i ƒë·∫∑t to√°n h·∫°ng th√†nh 0.

### 6: xva (Unsolved)

![·∫¢nh m√¥ t·∫£ nhi·ªám v·ª• 6](/src/2022/DownUnderCTF/xva/img/00_title.png)

### 7: click the flag (Unsolved)

![·∫¢nh m√¥ t·∫£ nhi·ªám v·ª• 7](/src/2022/DownUnderCTF/click-the-flag/img/00_title.png)

### 8: artisan (Unsolved)

![·∫¢nh m√¥ t·∫£ nhi·ªám v·ª• 8](/src/2022/DownUnderCTF/artisan/img/00_title.png) -->
