---
title: Incognito 4.0
author: vietzettt
date:  2023-02-17
layout: post
published: true
cover: /src/2023/Incognito4.0/cover.png
---

---

##### **Nguá»“n á»Ÿ Ä‘Ã¢y nhÃ¡ cÃ¡c báº¡n:** [ğŸ’€**ğŸ‘†ğŸ‘†ğŸ‘†**ğŸ’€](https://github.com/vietzettt/vietzettt.github.io/tree/main/src/Incognito4.0)

Xin chÃ o má»i ngÆ°á»i Ä‘áº¿n vá»›i giáº£i Ä‘á»£t nÃ y, giáº£i nÃ y team tÃ´i báº¯t Ä‘áº§u cÃ³ thÃªm cÃ¡c nhÃ¢n tá»‘ bÃ­ má»›i chÆ¡i..ğŸ‘¾ Váº«n nhÆ° thÆ°á»ng lá»‡ thÃ¬ sau Ä‘Ã¢y sáº½ lÃ  cÃ¡c nhiá»‡m vá»¥ vá» máº£ng RE. Báº¯t Ä‘áº§u thÃ´i....ğŸˆâ€â¬›

LÆ°u Ã½ lÃ  cÃ¡c giáº£i tá»›i tÃ´i sáº½ viáº¿t qua Ã½ tÆ°á»Ÿng máº¥y bÃ i dá»… lÃ m náº¿u tÃ´i lÃ m Ä‘á»ƒ cÃ³ thá»ƒ lÃ  nÆ¡i tham kháº£o cá»§a máº¥y báº¡n team tui hoáº·c nhá»¯ng báº¡n má»›i khÃ¡c.

### 1: Meow

Äá»‘i vá»›i thá»­ thÃ¡ch Ä‘áº§u tiÃªn vÃ  dá»… Ã²m Ä‘Ã£ cÃ³ hÆ¡n 200 team giáº£i ra thÃ¬ bÃ i nÃ y má»Ÿ file Ä‘Ã³ ra trÃªn pháº§n má»m dá»‹ch ngÆ°á»£c vÃ­ dá»¥ nhÆ° IDA pro.

LÃºc Ä‘áº§u tÃ´i Ä‘á»c qua thÃ¬ chÆ°Æ¡ng trÃ¬nh khÃ´ng cÃ³ gÃ¬ cáº£, tÃ´i tháº§m nghÄ© lÃ  chÆ°Æ¡ng trÃ¬nh tháº­t vÃ´ nghÄ©a khi khÃ´ng cÃ³ gÃ¬))). Sau Ä‘Ã³ tÃ´i nhÃ¬n qua toÃ n bá»™ cÃ¡c pháº§n cá»§a file, pháº§n data, code,... thÃ¬ phÃ¡t hiá»‡n ra chÆ°Æ¡ng trÃ¬nh lÆ°u trá»¯ file string gá»“m cÃ¡c kÃ½ tá»± táº¡o flag cÃ¡ch nhau báº±ng 1 byte NULL.

VÃ  xong tháº­t dá»… pháº£i khÃ´ng nÃ oğŸ‘»

### 2: Rev This

Vá»›i chall nÃ y thÃ¬ nhÆ° thÆ°á»ng lá»‡ thÃ¬ check file rá»“i Ä‘Æ°a vÃ o IDA check hÃ m main nÃ³ nhÆ° nÃ o:

```c
int __cdecl main(int argc, const char **argv, const char **envp)
{
  unsigned int v4; // [rsp+8h] [rbp-88h]
  int i; // [rsp+Ch] [rbp-84h]
  int j; // [rsp+10h] [rbp-80h]
  char v7[9]; // [rsp+17h] [rbp-79h]
  __int64 v8[6]; // [rsp+20h] [rbp-70h] BYREF
  __int64 v9[8]; // [rsp+50h] [rbp-40h] BYREF

  v9[7] = __readfsqword(0x28u);
  v4 = 0;
  memset(v8, 0, 34);
  *(__int64 *)((char *)&v8[4] + 2) = 0x100000000000000LL;
  memset(v9, 0, 34);
  *(__int64 *)((char *)&v9[4] + 2) = 0x100000000000000LL;
  rand_str(v8, 41LL);
  rand_str(v9, 41LL);
  for ( i = 0; i <= 40; ++i )
    v7[i] = *((_BYTE *)v9 + i) ^ *((_BYTE *)v8 + i);
  for ( j = 0; j <= 40; ++j )
    v4 += v7[j] - 4 * j;
  message(v4);
  return 0;
}
```

HÃ m main cá»§a chÆ°Æ¡ng trÃ¬nh lÃ  Ä‘Ã¢y.

VÃ  tÃ´i tháº¯c máº¯c hÃ m `message()` cháº¯c kháº£ nÄƒng nÃ³ Ä‘Ã¢y:

```c
__int64 __fastcall message(int a1)
{
  int i; // [rsp+1Ch] [rbp-34h]
  __int64 v3[4]; // [rsp+20h] [rbp-30h]
  char v4; // [rsp+40h] [rbp-10h]
  unsigned __int64 v5; // [rsp+48h] [rbp-8h]

  v5 = __readfsqword(0x28u);
  v3[0] = 0x6071B14091B0C06LL;
  v3[1] = 0x70806031C1C061CLL;
  v3[2] = 0xA0B1D0E0716031BLL;
  v3[3] = 0x41C0E1B190A1D1DLL;
  v4 = 18;
  for ( i = 0; i <= 32; ++i )
    putchar(a1 ^ *((char *)v3 + i));
  return 0LL;
}
```

NhÆ° trÃªn thÃ¬ hÃ m `message()` nÃ y sáº½ `putchar()` tá»«ng kÃ½ tá»± cá»§a flag ra cho mÃ¬nh.

Lá»£i dá»¥ng Ä‘iá»u Ä‘Ã³ mÃ  tÃ´i khÃ´ng cáº§n quan tÃ¢m Ä‘áº¿n pháº§n trÆ°á»›c cá»§a chÆ°Æ¡ng trÃ¬nh. VÃ¬ ta Ä‘Ã£ biáº¿t format cá»§a cá» lÃ  gÃ¬ rá»“i váº¥n Ä‘á» cÃ²n láº¡i lÃ  xor vá»›i giÃ¡ trá»‹ kia lÃ  ra thÃ´i...

VÃ  Ä‘Ã¢y lÃ  solve cá»§a tÃ´i báº±ng python:

```py
from __ctf import *
a = ['06071B14091B0C06', '070806031C1C061C', '0A0B1D0E0716031B', '041C0E1B190A1D1D']

lst = []
for i in a:
    for j in range(len(i),0,-2):
        lst.append(int(i[j-2:j],16))
        
for i in lst:
    print(chr(i^111),end='') # sá»‘ 111 lÃ  láº¥y giÃ¡ trá»‹ Ä‘áº§u tiÃªn xor vá»›i kÃ½ tá»± i
```

VÃ  nháº­n Ä‘Æ°á»£c flag...ğŸ‘‰

### 3: AnotherRev

Tiáº¿p Ä‘áº¿n lÃ  bÃ i nÃ y khiáº¿n tÃ´i máº¥t thá»i gian thÃ´i chá»© bÃ i nÃ y cÅ©ng dá»…, chá»‰ lÃ  sá»­ dá»¥ng z3 Ä‘á»ƒ lÃ m thÃ´i)))

Main cá»§a chÆ°Æ¡ng trÃ¬nh:

```c
int __cdecl main(int argc, const char **argv, const char **envp)
{
  read(0, &flag, 0x2BuLL);
  if ( (unsigned int)fun() )
    puts("Flag");
  else
    puts("Not flag");
  return 0;
}
```

HÃ m chÃ­nh tháº­t ngáº¯n gá»n vÃ  sÃºc tÃ­ch))).

Nháº­n tháº¥y flag nÃ y cÃ³ kÃ­ch thÆ°á»›c 0x2b tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i 43 kÃ½ tá»±.

VÃ  chÆ°Æ¡ng trÃ¬nh chuyá»ƒn Ä‘áº¿n kiá»ƒm tra flag báº±ng hÃ m `fun()` tráº£ vá» kiá»ƒu boolean Ä‘Ãºng hoáº·c sai 1 hoáº·c 0. Náº¿u 1 thÃ¬ cháº¯c cháº¯n rá»“i flag here....

VÃ o hÃ m `fun()` thÃ¬ á»‘i dá»“i Ã´i, chÆ°Æ¡ng trÃ¬nh gá»“m 41 cÃ¢u Ä‘iá»u kiá»‡n vÃ  1 cÃ¢u lá»‡nh gÃ¡n.

```c
_BOOL8 fun()
{
  int v1; // [rsp+0h] [rbp-4h]

  v1 = byte_405059 + byte_405068 == 109;
  if ( byte_405059
     + byte_40505F
     + byte_405058
     + byte_405050
     + byte_40505F
     + byte_405065
     + byte_405062
     + byte_405049
     + byte_405065
     + byte_405068 == 706 )
    ++v1;

//.....

  if ( byte_40504C
     + byte_405052
     + byte_405045
     + byte_405051
     + byte_40505D
     + byte_405065
     + byte_40504D
     + byte_405061
     + byte_405065
     + byte_405058
     + byte_405063
     + byte_40505C
     + byte_405062
     + byte_405066
     + byte_405061
     + flag == 1198 )
    ++v1;
  if ( byte_40504E + byte_405064 + byte_40504C + byte_40504D + byte_405054 == 295 )
    ++v1;
  return v1 == 42;
}
```

TÃ´i chá»‰ copy tá»«ng nÃ y thÃ´i vÃ¬ nÃ³ dÃ i quÃ¡))) vÃ  Ä‘Ã³ cÅ©ng lÃ  lÃ½ do khiáº¿n tÃ´i máº¥t nhiá»u thá»i gian cho nÃ³ mÃ  trong khi Ä‘Ã³ bÃ i nÃ y khÃ´ng cÃ³ gÃ¬ cáº£))).

Nháº­n tháº¥y náº¿u lÃ  flag thÃ¬ táº¥t cáº£ cÃ¡c Ä‘iá»u kiá»‡n pháº£i Ä‘Ãºng Ä‘á»ƒ giÃ¡ trá»‹ cá»§a `v1` cá»™ng 1 sau má»—i cÃ¢u Ä‘iá»u kiá»‡n vÃ  cÃ¢u lá»‡nh gÃ¡n Ä‘áº§u tiÃªn cÅ©ng Ä‘Ãºng Ä‘á»ƒ giÃ¡ trá»‹ `v1` lÃºc Ä‘áº§u báº±ng 1.

Cá»™ng tá»•ng vÃ o báº±ng 42 lÃ  Ä‘Ãºng flag...

cÃ¡c `byte_...` thá»±c cháº¥t ra lÃ  cÃ¡c kÃ½ tá»± cá»§a flag thÃ´i... DÆ°á»›i Ä‘Ã¢y tÃ´i giáº£i thÃ­ch luÃ´n nÃ¨:

![flag_check](/src/2023/Incognito4.0/AnotherRev/flag_check.png)

ÄÃ³ nhÆ° cÃ¡c báº¡n tháº¥y thÃ¬ cÃ¡c `byte_...` Ä‘Æ°á»£c IDA nháº­n dáº¡ng lÃ  cÃ¡c bytes náº±m gáº§n nhau... cháº¯c cÃ³ Ã½ Ä‘á»“ gÃ¬ cá»§a tÃ¡c giáº£ khiáº¿n mÃ¬nh nhÃ¬n dá»‘i code thÃ´i. Chá»© nghÄ© Ä‘Æ¡n giáº£n nÃ³ lÃ  má»™t máº£ng flag. Pháº§n tá»­ Ä‘áº§u tiÃªn cÃ³ tÃªn lÃ  flag; pháº§n tá»­ thá»© 2 lÃ  `byte_405041` .v.v. Cá»© nhÆ° váº­y lÃ  xong.

CÃ²n láº¡i lÃ  viá»‡c sá»­ dá»¥ng cÃ¡c Ä‘iá»u kiá»‡n Ä‘Ã³ Ä‘á»ƒ ra flag thÃ´i. Vá»›i nhiá»u Ä‘iá»u kiá»‡n nÃ y thÃ¬ Z3 khÃ´ng ai khÃ¡c lÃ  trá»£ thá»§ cá»±c ká»³ Ä‘áº¯c lá»±c Ä‘á»‘i vá»›i má»i cÃ¡c dÃ¢n chÆ¡i RE))).

Copy vÃ  fix láº¡i 1 há»“i ná»­a tiáº¿t há»c cá»§a tÃ´i á»Ÿ trÆ°á»ngğŸ¥². ÄÃ¢y lÃ  lá»i giáº£i cá»§a tÃ´i:

```py

from z3 import *

s = Solver()
flag = [BitVec(f'flag{i}', 8) for i in range(0,43)]

for i in range(1,43):
      s.add(And(flag[i]>0, flag[i]<127))

s.add(flag[0] ==99)

s.add(flag[26] + flag[41] == 109)
s.add(flag[26] + flag[32] + flag[25] + flag[17] + flag[32] + flag[38] + flag[35] + flag[10] + flag[38] + flag[41] == 706)

s.add(flag[38] + flag[22] + flag[25] + flag[22] + flag[18] + flag[33] + flag[6] + flag[9] + flag[12] + flag[6] + flag[20] == 764)

s.add(flag[21] + flag[1] + flag[4] + flag[42] + flag[41] + flag[2] + flag[25] + flag[41] + flag[3] + flag[27] + flag[14] + flag[32] + flag[22] + flag[22] + flag[2] + flag[23] == 1395)

s.add(flag[25] + flag[8] + flag[14] + flag[32] + flag[34] + flag[15] + flag[31] + flag[26] + flag[11] + flag[35] + flag[24] == 753)

s.add(flag[2] + flag[18] + flag[8] + flag[6] == 261)

s.add(flag[9] + flag[25] + flag[32] + flag[26] + flag[11] + flag[39] + flag[30] + flag[30] + flag[13] + flag[22] == 666)

s.add(flag[15] + flag[39] + flag[22] == 300)

s.add(flag[22] + flag[33] + flag[41] + flag[36] + flag[32] + flag[24] + flag[29] + flag[8] + flag[2] + flag[9] + flag[14] + flag[33] + flag[30] + flag[26] + flag[5] == 933)

s.add(flag[37] + flag[13] + flag[34] + flag[41] + flag[21] + flag[23] + flag[6] + flag[27] + flag[33] + flag[32] + flag[35] + flag[3] + flag[9] + flag[40] + flag[19] + flag[22] == 1168)

s.add(flag[23] + flag[24] + flag[29] + flag[3] + flag[25] + flag[42] + flag[42] + flag[35] + flag[42] + flag[28] + flag[21] + flag[29] + flag[20] + flag[22] + flag[10] + flag[17] + flag[31] == 1375)

s.add(flag[36] + flag[19] + flag[26] + flag[30] + flag[39] + flag[20] + flag[31] == 409)

s.add(flag[39] + flag[3] + flag[33] + flag[17] + flag[26] + flag[12] + flag[17] + flag[29] + flag[1] + flag[28] + flag[29] == 765)

s.add(flag[21] + flag[25] + flag[19] + flag[25] + flag[26] + flag[29] + flag[39] + flag[5] + flag[14] + flag[39] + flag[28] + flag[24] == 902)

s.add(flag[5] + flag[41] == 178)

s.add(flag[28] + flag[30] + flag[26] + flag[38] + flag[24] + flag[32] + flag[15] + flag[15] + flag[15] + flag[32] + flag[27] + flag[11] + flag[13] + flag[17] + flag[34] + flag[4] + flag[32] + flag[28] + flag[2] + flag[32] == 1513)

s.add(flag[7] + flag[11] + flag[41] == 165)

s.add(flag[18] + flag[2] + flag[41] + flag[35] + flag[9] + flag[12] + flag[38] + flag[17] + flag[14] + flag[11] == 653)

s.add(flag[40] + flag[31] + flag[5] + flag[23] + flag[8] + flag[30] + flag[24] + flag[25] + flag[37] + flag[30] + flag[33] + flag[29] + flag[10] + flag[5] + flag[41] + flag[13] + flag[41] + flag[20] + flag[36] == 1266)

s.add(flag[29] + flag[39] + flag[22] + flag[39] + flag[27] + flag[25] + flag[3] + flag[33] == 711)

s.add(flag[40] + flag[2] + flag[12] + flag[10] + flag[5] + flag[16] + flag[2] + flag[10] + flag[36] + flag[22] + flag[20] + flag[26] + flag[24] + flag[41] + flag[1] + flag[20] + flag[40] == 1294)

s.add(flag[5] + flag[27] + flag[2] + flag[10] + flag[21] + flag[21] + flag[19] + flag[38] + flag[26] + flag[16] + flag[38] + flag[9] + flag[16] + flag[3] + flag[29] + flag[11] + flag[36] + flag[41] + flag[42] == 1485)

s.add(flag[31] + flag[17] == 100)

s.add(flag[23] + flag[14] + flag[6] + flag[42] + flag[36] + flag[17] + flag[24] + flag[8] + flag[1] + flag[16] + flag[7] + flag[6] + flag[16] == 945)

s.add(flag[13] + flag[1] + flag[40] + flag[23] + flag[19] + flag[33] + flag[4] + flag[1] + flag[2] + flag[37] + flag[25] + flag[26] + flag[23] + flag[34] + flag[9] + flag[5] == 1327)

s.add(flag[31] + flag[40] + flag[24] + flag[13] + flag[42] + flag[28] + flag[23] + flag[13] + flag[8] + flag[3] + flag[7] + flag[14] + flag[3] + flag[15] + flag[9] + flag[24] + 2 * flag[26] + flag[41] == 1370)

s.add(flag[22] + flag[30] + flag[3] + flag[21] + flag[31] + flag[41] == 426)

s.add(flag[11] + flag[36] + flag[19] + flag[16] + flag[8] + flag[28] + flag[20] + flag[13] + flag[12] + flag[10] + flag[22] + flag[41] + flag[4] + flag[39] + flag[4] + flag[22] + flag[17] + flag[27] == 1329)

s.add(flag[7] + flag[40] + flag[1] + flag[2] + flag[20] + flag[35] + flag[23] + flag[14] + flag[15] + flag[42] + flag[38] + flag[5] + flag[38] == 1199)

s.add(flag[20] + flag[13] + flag[11] + flag[27] + flag[12] + flag[28] + flag[29] + flag[7] + flag[35] + flag[15] + flag[5] + flag[7] + flag[13] + flag[1] + flag[28] + flag[24] + flag[7] + flag[42] + flag[4] == 1470)

s.add(flag[4] + flag[17] + flag[11] == 206)

s.add(flag[30] + flag[34] + flag[41] + flag[33] + flag[28] + flag[13] + flag[8] == 470)

s.add(flag[36] + flag[17] + flag[23] + flag[33] + flag[33] + flag[18] + flag[30] + flag[6] + flag[3] + flag[11] + flag[20] + flag[5] + flag[23] + flag[23] + flag[21] + flag[17] + flag[35] + flag[13] + flag[20] == 1302)

s.add(flag[42] + flag[6] + flag[15] + flag[32] + flag[38] + flag[10] + flag[40] + flag[28] + flag[11] + flag[35] + flag[35] == 936)

s.add(flag[6] + flag[10] + flag[5] == 234)

s.add(flag[2] + flag[35] + flag[38] + flag[40] + flag[3] + flag[19] + flag[33] + flag[41] + flag[27] + flag[4] + flag[32] + flag[34] + flag[34] == 1116)

s.add(flag[10] + flag[14] + flag[17] + flag[2] + flag[16] + flag[30] + flag[5] + flag[23] + flag[4] + flag[12] == 777)

s.add(flag[29] + flag[40] + flag[33] + flag[35] + flag[8] + flag[19] == 394)

s.add(flag[31] + flag[14] + flag[9] + flag[25] + flag[20] + flag[32] + flag[17] + flag[7] + flag[14] + flag[31] + flag[30] + flag[1] == 705)

s.add(flag[2] + flag[15] == 200)

s.add(flag[13] + flag[19] + flag[6] + flag[18] + flag[30] + flag[38] + flag[14] + flag[34] + flag[38] + flag[25] + flag[36] + flag[29] + flag[35] + flag[39] + flag[34] + flag[1] == 1198)

s.add(flag[15] + flag[37] + flag[13] + flag[14] + flag[21] == 295)

if s.check() == sat:
      sol = []
      for i in range(1,43):
            sol.append(s.model().eval(flag[i]).as_long())
      print(''.join([chr(int(c)) for c in sol]))
```

Cá»© cháº¡y lÃ  ra flag. Náº¿u lÃ m truyá»n thá»‘ng thÃ¬ máº¥t ráº¥t nhiá»u thá»i gian nhÃ© cÃ¡c pro cá»§a tÃ´i...

### 4: Gainme

BÃ i nÃ y lÃ  bÃ i á»Ÿ pháº§n pwn nhÆ°ng tÃ´i tháº¥y thÃ¬ nÃ³ thá»±c cháº¥t lÃ  bÃ i RE hay lÃ  nÃ³ cÃ³ lá»—i gÃ¬ Ä‘Ã³ Ä‘á»ƒ cÃ³ thá»ƒ nhanh hÆ¡n.

TÃ´i cÅ©ng khÃ´ng biáº¿t ná»¯a. Cháº¡y file vÃ  Ä‘á»c file tháº¥y chÆ°Æ¡ng trÃ¬nh yÃªu cáº§u mÃ¬nh tráº£i qua 3 cáº¥p Ä‘á»™ kiá»ƒm tra tÆ°Æ¡ng á»©ng vá»›i level. CÃ¡c level sáº½ tÆ°Æ¡ng á»©ng vá»›i hÃ m khÃ¡c nhau Ä‘á»ƒ kiá»ƒm tra Ä‘áº§u vÃ o cá»§a ta.

- Level 1: thÃ¬ so sÃ¡nh chuá»—i `ICTF4`
- Level 2: cÅ©ng so sÃ¡nh chuá»—i `dasDASQWgjtrkodsc`
- Level 3: so sÃ¡nh giÃ¡ trá»‹ báº±ng vá»›i Ä‘á»‹a chá»‰ `0xDEADBEEF`
- Level cuá»‘i thÃ¬ input giÃ¡ trá»‹ Ä‘áº§u vÃ o chuyá»ƒn nÃ³ thÃ nh sá»‘ rá»“i tÃ­nh toÃ¡n theo 1 biá»ƒu thá»©c mÃ  giÃ¡ trá»‹ cá»§a biá»ƒu thá»©c nÃ y pháº£i báº±ng 0 Ä‘á»ƒ khÃ´ng bá»‹ thoÃ¡t chÆ°Æ¡ng trÃ¬nh.

Má»¥c tiÃªu lÃ  thá»a mÃ£n táº¥t cáº£ cÃ¡c level Ä‘á»ƒ khÃ´ng bá»‹ cash chÆ°Æ¡ng trÃ¬nh á»Ÿ pháº§n nÃ o ká»ƒ. Káº¿t thÃºc thÃ¬ sáº½ Ä‘áº¿n pháº§n Ä‘á»c file flag.txt cá»§a mÃ¡y nhÃ  tá»• chá»©c)))..

ÄÃ³ lÃ  táº¥t cáº£ Ã½ tÆ°á»Ÿng. VÃ  sau Ä‘Ã¢y lÃ  solve cá»§a tÃ´i cho cÃ¡c báº¡n tham kháº£o:

```py
from pwn import *

r = remote("143.198.219.171", 5003)

payload = b'ICTF4'
r.sendline(payload)

payload1 = b'dasDASQWgjtrkodsc'
r.sendline(payload1)

payload2 = p32(0xDEADBEEF)
r.sendline(payload2)

payload3 = b'1'
r.sendline(payload3)

r.interactive()  # Ä‘á»ƒ tÆ°Æ¡ng tÃ¡c vá»›i shell
```

NhÆ° váº­y káº¿t thÃºc cÃ¡i giáº£i dá»… nÃ y nhÃ©ğŸ‘¾. Cáº£m Æ¡n má»i ngÆ°á»i Ä‘Ã£ Ä‘á»c Ä‘áº¿n Ä‘Ã¢y.
